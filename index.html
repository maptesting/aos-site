<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AOS ‚Äî AI Receptionist Prompt Pack (Free Builder)</title>

  <!-- SEO -->
  <meta name="description" content="Build your own AI Receptionist in 30 seconds ‚Äî free. Generate prompts, workflows, and voice previews for any business.">
  <meta property="og:title" content="AOS ‚Äî Free AI Receptionist Builder">
  <meta property="og:description" content="Generate a custom AI receptionist instantly ‚Äî prompt, workflows, and voice demo included.">
  <meta property="og:image" content="https://yourdomain.com/og-preview.png">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">

  <!-- Favicon -->
  <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">ü§ñ</text></svg>'>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { theme: { extend: {
      colors:{ brand:{500:"#556dff",600:"#3d4fe6"}, ink:"#0b0f1a" },
      boxShadow:{ soft:"0 8px 30px rgba(0,0,0,.18)" }
    }}};
  </script>
  <style>
    body{background:#0b0f1a;color:#fff}
    .gradient{background:
      radial-gradient(1200px 600px at 20% -10%, rgba(85,109,255,.25), transparent 60%),
      radial-gradient(1000px 600px at 100% 0%, rgba(34,42,130,.35), transparent 60%);}
    .glass{backdrop-filter:blur(10px);background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08)}
    .code{white-space:pre-wrap;font-family:ui-monospace,Menlo,Consolas,monospace}
    input,textarea,select{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:.9rem 1rem}
    input::placeholder,textarea::placeholder{color:rgba(255,255,255,.4)}
    input:focus,textarea:focus,select:focus{outline:none;box-shadow:0 0 0 2px rgba(85,109,255,.5)}
    .range {appearance:none;height:6px;border-radius:9999px;background:linear-gradient(to right,#556dff var(--pct,0%),rgba(255,255,255,.2) 0)}
    .range::-webkit-slider-thumb{appearance:none;width:14px;height:14px;border-radius:9999px;background:#fff;border:2px solid #556dff;box-shadow:0 0 0 3px rgba(85,109,255,.25)}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,.1)}
    .muted{color:rgba(255,255,255,.65)}
    .hidden{display:none}
  </style>
</head>
<body>
  <header class="gradient border-b border-white/10">
    <div class="max-w-6xl mx-auto px-4 py-6 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-xl bg-brand-500 grid place-items-center">ü§ñ</div>
        <div>
          <div class="font-semibold">AOS</div>
          <div class="text-white/60 text-xs">AI Optimization Solutions</div>
        </div>
      </div>
      <nav class="flex items-center gap-2">
        <a href="#/" class="px-4 py-2 rounded-xl bg-white/10 hover:bg-white/15">Home</a>
        <a href="#builder" class="px-4 py-2 rounded-xl bg-brand-500 hover:bg-brand-600">Build Free</a>
      </nav>
    </div>
  </header>

  <!-- =========================
       VIEW: HOME (Landing + Receptionist + Agent list + Video bottom)
       ========================= -->
  <main id="view-home">
    <!-- Hero -->
    <section class="relative gradient overflow-hidden">
      <div class="mx-auto max-w-7xl px-4 pt-20 pb-16 md:pt-24 md:pb-24">
        <div class="grid md:grid-cols-2 gap-16 items-start">
          <!-- Left -->
          <div>
            <h1 class="text-4xl md:text-5xl font-extrabold leading-tight">
              AI Receptionist Prompt Pack ‚Äî <span class="text-brand-500">Free Builder</span>
            </h1>
            <p class="mt-6 text-white/70 max-w-2xl leading-relaxed">
              Answer a few questions about your business. Get a production-ready System Prompt (preview) and
              download two <b>n8n</b> workflows ‚Äî <em>checkAvailability</em> and <em>bookAppointment</em>.
            </p>
            <div class="mt-8">
              <a href="#builder" class="px-5 py-3 rounded-xl bg-brand-500 hover:bg-brand-600">Start Building</a>
            </div>
          </div>

          <!-- Live Demo Chat -->
          <div class="glass rounded-2xl p-6 md:p-8 shadow-soft mt-6 md:mt-0">
            <div class="text-sm text-white/60 mb-2">Talk to Ava ‚Äî Receptionist at BrightSmile Dental Clinic</div>
            <div id="chatBox" class="h-64 overflow-y-auto bg-black/20 rounded-xl p-3 space-y-3 text-sm border border-white/10">
              <div class="flex gap-3">
                <div class="w-8 h-8 rounded-full bg-brand-500 grid place-items-center">ü§ñ</div>
                <div>Hi! This is Ava from BrightSmile Dental ‚Äî how can I help you today?</div>
              </div>
            </div>
            <form id="chatForm" class="mt-3 flex gap-2" action="javascript:void(0)" autocomplete="off">
              <input id="chatInput" type="text" placeholder="Type your message..." class="flex-1 bg-white/5 border border-white/10 rounded-xl px-3 py-2 text-sm" required>
              <button id="chatSend" type="submit" class="bg-brand-500 hover:bg-brand-600 rounded-xl px-4 py-2 text-sm font-medium">Send</button>
            </form>
          </div>
        </div>
      </div>
    </section>

    <!-- Builder -->
    <section id="builder" class="py-24 md:py-32 scroll-mt-28">
      <div class="max-w-6xl mx-auto px-4">
        <h2 class="text-center text-3xl font-bold mb-10 text-white">Build your AI Receptionist here üëá</h2>
        <div class="glass rounded-2xl p-6 md:p-10">
          <div class="flex items-start justify-between gap-12 flex-col lg:flex-row">
            <!-- Form -->
            <div class="w-full lg:w-1/2">
              <h3 class="text-2xl font-semibold mb-4">Your Business</h3>
              <form id="aiForm" class="grid gap-4 mt-4">
                <input name="bizName" placeholder="Business Name" required>
                <input name="location" placeholder="Location / Service area" required>
                <input name="industry" placeholder="Industry (e.g., salon, rentals, clinic)" required>
                <input name="services" placeholder="Services (comma-separated)" required>
                <div class="grid md:grid-cols-2 gap-4">
                  <input name="agentName" placeholder="Agent Name" value="Alex">
                  <input name="language" placeholder="Language" value="English">
                </div>
                <div class="grid md:grid-cols-2 gap-4">
                  <input name="hours" placeholder="Hours (e.g., Mon‚ÄìSat 9‚Äì6)">
                  <input name="timezone" placeholder="Timezone (e.g., America/New_York)">
                </div>
                <div class="grid md:grid-cols-2 gap-4">
                  <input name="calendarId" placeholder="Google Calendar ID (e.g., primary)">
                  <input name="email" type="email" placeholder="Confirmation email sender (optional)">
                </div>
                <textarea name="policies" rows="2" placeholder="Policies / deposits / refunds (optional)"></textarea>

                <!-- Voice picker row -->
                <div class="grid md:grid-cols-2 gap-4 items-end">
                  <div>
                    <label class="block text-sm text-white/70 mb-1" for="voiceSelect">Voice</label>
                    <select id="voiceSelect">
                      <option>Loading voices‚Ä¶</option>
                    </select>
                  </div>
                  <div class="mt-3 md:mt-0 flex gap-3 flex-wrap">
                    <button type="button" id="previewBtn" class="px-4 py-3 rounded-xl bg-brand-500 hover:bg-brand-600 font-medium inline-flex items-center gap-2">
                      <span id="previewSpinner" class="hidden inline-block w-4 h-4 border-2 border-white/40 border-t-white rounded-full animate-spin"></span>
                      <span>Generate Preview</span>
                    </button>
                    <button type="button" id="ttsBtn" class="px-4 py-3 rounded-xl border border-white/10 hover:bg-white/5 font-medium">‚ñ∂ Hear AI Greeting</button>
                  </div>
                </div>
              </form>
            </div>

            <!-- Preview + Downloads + Audio -->
            <div class="w-full lg:w-1/2">
              <div class="glass rounded-2xl p-5 h-full">
                <h3 class="text-xl font-semibold">System Prompt ‚Äî Preview</h3>
                <div class="text-xs text-white/60">Preview only (truncated)</div>
                <div id="promptOut" class="code text-sm bg-black/30 rounded-xl p-4 border border-white/10 min-h-[280px] mt-3"></div>

                <div class="mt-6">
                  <h4 class="text-sm font-semibold text-white/80 mb-2">Downloads</h4>
                  <div class="flex flex-wrap gap-2">
                    <button id="downloadPromptBtn" class="px-4 py-2 rounded-xl bg-brand-500/80 hover:bg-brand-600 font-medium disabled:opacity-50" disabled>Download Full Prompt (.txt)</button>
                    <button id="downloadAvailBtn" class="px-4 py-2 rounded-xl border border-white/10 hover:bg-white/5 disabled:opacity-50" disabled>Download: checkAvailability.json</button>
                    <button id="downloadBookBtn" class="px-4 py-2 rounded-xl border border-white/10 hover:bg-white/5 disabled:opacity-50" disabled>Download: bookAppointment.json</button>
                  </div>
                  <div id="successMsg" class="hidden mt-3 text-sm text-green-400">Downloaded ‚úÖ</div>
                </div>

                <!-- Custom Audio Player -->
                <div class="mt-6">
                  <audio id="audio" class="hidden"></audio>
                  <div id="audioUI" class="hidden glass rounded-xl p-4">
                    <div class="flex items-center gap-3">
                      <button id="audioPlay" class="w-10 h-10 rounded-full bg-brand-500 hover:bg-brand-600 grid place-items-center text-black font-bold">‚ñ∂</button>
                      <div class="flex-1">
                        <input id="audioSeek" type="range" min="0" max="100" value="0" class="w-full range">
                        <div class="flex justify-between text-xs text-white/60 mt-1">
                          <span id="audioTime">0:00</span>
                          <span id="audioDur">0:00</span>
                        </div>
                      </div>
                      <a id="audioDownload" download="ai-greeting.mp3" class="text-sm underline decoration-blue-400">Download</a>
                    </div>
                  </div>
                  <div id="notice" class="mt-2 text-xs text-white/60"></div>
                  <div id="debug" class="mt-2 text-xs text-red-400"></div>
                </div>
              </div>
            </div>
          </div>

        </div>

        <p class="text-center text-sm text-white/50 mt-8">
          After import, attach your Google Calendar OAuth2 and OpenAI credentials in n8n.
        </p>
      </div>
    </section>

    <!-- =========================
         NEW: Agents (moved directly under Receptionist)
         ========================= -->
    <section id="agents" class="py-20 border-t border-white/10">
      <div class="max-w-6xl mx-auto px-4">
        <h2 class="text-3xl font-bold mb-6">More Plug-and-Play Agents</h2>
        <p class="muted mb-6">These are separate from the receptionist. Click one to open its own page and enter the info for that agent to generate the **Full Prompt** and **n8n JSON** tailored to that business.</p>

        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
          <a href="#/agent/invoice" class="glass rounded-2xl p-5 block hover:bg-white/5">
            <div class="text-lg font-semibold">üßæ AI Invoice / Follow-ups</div>
            <div class="text-sm text-white/70 mt-1">Generate invoices + polite reminders and email them. Logs to Airtable.</div>
          </a>

          <a href="#/agent/salesCloser" class="glass rounded-2xl p-5 block hover:bg-white/5">
            <div class="text-lg font-semibold">üìà AI Sales Closer</div>
            <div class="text-sm text-white/70 mt-1">Objection-aware nudges via SMS/Email. Auto-logs follow-ups.</div>
          </a>

          <a href="#/agent/leadQualifier" class="glass rounded-2xl p-5 block hover:bg-white/5">
            <div class="text-lg font-semibold">üìû AI Lead Qualifier</div>
            <div class="text-sm text-white/70 mt-1">Score & route leads (A/B/C). Email both lead & owner with next steps.</div>
          </a>

          <a href="#/agent/dmResponder" class="glass rounded-2xl p-5 block hover:bg-white/5">
            <div class="text-lg font-semibold">üí¨ AI DM Responder</div>
            <div class="text-sm text-white/70 mt-1">Short replies for IG/TikTok that push to your CTA. Tags & logs.</div>
          </a>
        </div>
      </div>
    </section>

    <!-- =========================
         Video AT THE VERY BOTTOM
         ========================= -->
    <section class="py-20 border-t border-white/10">
      <div class="max-w-6xl mx-auto px-4">
        <h3 class="text-xl font-semibold mb-3">How to use this builder (video)</h3>
        <div class="rounded-2xl overflow-hidden border border-white/10 shadow-soft aspect-video">
          <iframe
            class="w-full h-full"
            src="https://www.youtube.com/embed/Akwe5h3CQKo?si=Q-Uto-rIMjTar1vv"
            title="AOS ‚Äî How to use the AI Receptionist Builder"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            referrerpolicy="strict-origin-when-cross-origin"
            allowfullscreen></iframe>
        </div>
      </div>
    </section>
  </main>

  <!-- =========================
       VIEW: AGENT DETAIL (SPA)
       ========================= -->
  <main id="view-agent" class="hidden">
    <section class="py-10">
      <div class="max-w-5xl mx-auto px-4">
        <a href="#/" class="inline-flex items-center gap-2 text-white/80 hover:text-white mb-6">
          ‚Üê Back
        </a>
        <div class="glass rounded-2xl p-6 md:p-8">
          <h2 id="agentTitle" class="text-2xl font-bold"></h2>
          <p id="agentDesc" class="text-white/70 mt-2"></p>

          <!-- Agent-specific form -->
          <form id="agentForm" class="grid gap-4 mt-6"></form>

          <!-- Output/downloads -->
          <div class="mt-6">
            <div class="flex flex-wrap gap-2">
              <button id="agentGenerate" class="px-4 py-2 rounded-xl bg-brand-500 hover:bg-brand-600 font-medium">Generate</button>
              <a id="agentPromptDownload" class="px-4 py-2 rounded-xl btn-ghost">Download Full Prompt (.txt)</a>
              <a id="agentJsonDownload" class="px-4 py-2 rounded-xl btn-ghost">Download n8n JSON</a>
            </div>
            <div id="agentMsg" class="text-xs text-green-400 mt-3 hidden">Generated ‚úì</div>

            <h4 class="mt-6 font-semibold">Prompt Preview</h4>
            <div id="agentPromptPreview" class="code text-sm bg-black/30 rounded-xl p-4 border border-white/10 min-h-[180px] mt-2"></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="py-10 text-center text-white/40 text-sm">
    ¬© <span id="year"></span> AOS ‚Äî AI Optimization Solutions
  </footer>
  <script>document.getElementById('year').textContent = new Date().getFullYear();</script>

  <!-- ====== EMBEDDED TEMPLATES (RECEPTIONIST ‚Äî EXACTLY YOUR JSONS) ====== -->
  <script id="tplCheckAvailability" type="application/json">
{
  "name": "checkAvailability",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "0635b597-12bc-4601-87d9-530c58e028ff",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [-640,432],
      "id": "09e7f082-cfac-4027-80a6-9edeb64ef87d",
      "name": "Webhook",
      "webhookId": "0635b597-12bc-4601-87d9-530c58e028ff"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Role: \n\nYou are an appointment availability checker. Your job is to get the requested time and use the calendar to check availability for the customer.\n\nThe current date and time is: {{ $now }}\n\nCustomer requested time is:\n{{ $json.body.message.toolCallList[0].function.arguments.time }}\n\nCalendar data:\nWorking hours 8am - 9pm\nLength of each slot: 1 hour\n\nBooking Process\n\n-Check if the customer‚Äôs requested time is available using the calendar\n-If the time is available let the AI model know & confirm\n-If the time is unavailable, suggest up to 2 alternative slots close to the requested time, by checking the availability again\n-If there are no slots upon rechecking within that day, search the next weekday from the current time and provide alternative slots. \n\nResponse & output:\n\n-If the requested time is available confirm it by saying:\nE.g: The requested time of 10am on June 22nd is available, just to confirm would you like to book this?\n-If you have found no availability or unavailable in the requested time, suggest up to 3 alternative slots closest to the requested time.\n-If no slots exist within the day suggest 3 more times the next weekday.\n-Your output must be natural and conversational e.g. ‚ÄúHey there, the time that you requested of 10am on June 22nd is available, just to confirm would you like to book this?‚Äù\n\nImportant notes:\n\n- You must not output your result in the past, aways check availability in the future, use the current time you have received and the requested data to help make that decision.\n-Your ability to follow these steps precisely is very crucial and can impact the business‚Äôs reputation.",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [-336,368],
      "id": "75f18a8b-f48d-4027-8872-98ce8cbd7ecd",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [-416,608],
      "id": "bde217d0-c5bb-412f-9b56-b50967ddcbee",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "exm7lxhShqpiglPn",
          "name": "n8n free OpenAI API credits"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\n  \"results\": [\n    {\n      \"toolCallId\": \"{{ $('Webhook').item.json.body.message.toolCalls[0].id }}\",\n      \"result\": \"{{ $json.output }}\"\n    }\n  ]\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [64,416],
      "id": "ffe1fcc9-82a3-4284-9069-897621ab7d13",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "resource": "calendar",
        "calendar": {
          "__rl": true,
          "value": "razerrtrading@gmail.com",
          "mode": "list",
          "cachedResultName": "razerrtrading@gmail.com"
        },
        "timeMin": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start_Time', ``, 'string') }}",
        "timeMax": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End_Time', ``, 'string') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [-144,624],
      "id": "fe54952b-15ca-4f28-a9b3-476ca9858ae4",
      "name": "check availability",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "VyBLeoRYD28XxnYS",
          "name": "Google Calendar account"
        }
      }
    }
  ],
  "pinData": { "Webhook": [ { "json": { "headers": {}, "params": {}, "query": {}, "body": {} }, "webhookUrl": "", "executionMode": "test" } ] },
  "connections": {
    "Webhook": { "main": [ [ { "node": "AI Agent", "type": "main", "index": 0 } ] ] },
    "OpenAI Chat Model": { "ai_languageModel": [ [ { "node": "AI Agent", "type": "ai_languageModel", "index": 0 } ] ] },
    "AI Agent": { "main": [ [ { "node": "Respond to Webhook", "type": "main", "index": 0 } ] ] },
    "check availability": { "ai_tool": [ [ { "node": "AI Agent", "type": "ai_tool", "index": 0 } ] ] }
  },
  "active": false,
  "settings": { "executionOrder": "v1" },
  "versionId": "6244fb20-f4d2-4e76-bc7b-bfbcc2e69ffb",
  "meta": { "templateCredsSetupCompleted": true, "instanceId": "7f9d..." },
  "id": "s2Oz4PD8hi3d8dXJ",
  "tags": []
}
  </script>

  <script id="tplBookAppointment" type="application/json">
{
  "name": "bookAppointment",
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are a appointment booking AI Agent your job is to use the \"Create an event in Google Calendar\" tool to get the details of the customer and create a event/ booking in the calendar. \n\nThe confirmed time:  {{ $json.body.message.toolCalls[0].function.arguments.time }}\n\nTime now (use for bookings) : {{ $now }}\n\nAppointment duration will be one hour. Simply add one hour on to the confirm time, use the confirm time as the start time and then simply just add one hour on to the confirm time to get the end time. \n\nIf the event has been schedualed please provide your output in this format:\n\nOutput: \n\nHey there the appointment at July 18th 2025 for a message has been schedualed we will see you there. ",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [-832,144],
      "id": "b4d922ad-2b69-49d5-a2da-17c1ecbe345f",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [-912,384],
      "id": "c1c61458-8e97-4e7c-ab54-d395e74ae84a",
      "name": "OpenAI Chat Model"
    },
    {
      "parameters": {
        "calendar": {
          "__rl": true,
          "value": "razerrtrading@gmail.com",
          "mode": "list",
          "cachedResultName": "razerrtrading@gmail.com"
        },
        "start": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}",
        "end": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}",
        "additionalFields": {
          "attendees": [ "={{ $('Webhook1').item.json.body.message.toolCalls[0].function.arguments.email }}" ],
          "description": "=Details of the Appointment: \nname:{{ $json.body.message.toolCallList[0].function.arguments.full_name }} \nService Type: {{ $('Webhook1').item.json.body.message.toolCalls[0].function.arguments.service_type }}\nTime::{{ $json.body.message.toolCallList[0].function.arguments.time }} \nEmail:{{ $('Webhook1').item.json.body.message.toolCalls[0].function.arguments.email }}",
          "summary": "=New Appointment For  {{ $json.body.message.toolCallList[0].function.arguments.full_name }} at {{ $json.body.message.toolCallList[0].function.arguments.time }}"
        }
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [-672,384],
      "id": "7b5d02c2-e5e4-4609-ad6c-4ba402a9a757",
      "name": "Create an event in Google Calendar"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\n  \"results\": [\n    {\n      \"toolCallId\": \"{{ $('Webhook1').item.json.body.message.toolCalls[0].id }}\",\n      \"result\": \"{{ $json.output }}\"\n    }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [-368,224],
      "id": "57b1eac0-b482-4a59-9228-a6cc5cd30025",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "test77823457892345879245",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [-1104,208],
      "id": "a5013f1c-24ed-4d41-8d36-e9a579100421",
      "name": "Webhook1",
      "webhookId": "e909a8bc-5aba-477b-a3d5-3be663cd655d"
    }
  ],
  "pinData": { "Webhook1": [ { "json": { "headers": {}, "params": {}, "query": {}, "body": {} }, "webhookUrl": "", "executionMode": "test" } ] },
  "connections": {
    "OpenAI Chat Model": { "ai_languageModel": [ [ { "node": "AI Agent", "type": "ai_languageModel", "index": 0 } ] ] },
    "Create an event in Google Calendar": { "ai_tool": [ [ { "node": "AI Agent", "type": "ai_tool", "index": 0 } ] ] },
    "AI Agent": { "main": [ [ { "node": "Respond to Webhook", "type": "main", "index": 0 } ] ] },
    "Webhook1": { "main": [ [ { "node": "AI Agent", "type": "main", "index": 0 } ] ] }
  },
  "active": false,
  "settings": { "executionOrder": "v1" },
  "versionId": "1204e689-05e3-4059-82cc-e6e5cac9d410",
  "meta": { "instanceId": "7f9d..." },
  "id": "rk03nuO44WQh49bc",
  "tags": []
}
  </script>
  <!-- ====== /EMBEDDED TEMPLATES (RECEPTIONIST) ====== -->

  <!-- ====== NEW: AGENT PROMPTS (LONG) ====== -->
  <script id="prInvoice" type="text/plain">
You are {{AGENT_NAME}}, an invoice/follow-up assistant for {{BIZ_NAME}}.
Task: when provided a customer + line items, generate a clear, friendly invoice email with due date, payment link, and gentle follow-ups if overdue.

Must collect/accept:
- client name, email
- line items as [{desc, qty, unitPrice}] and compute totals
- taxes/fees per {{TAX_RULES_SNIPPET}} if provided
- terms, due date, payment link {{PAYMENT_LINK}}
- business contact {{BIZ_EMAIL}}

Tone: professional, 2‚Äì4 short sentences, no fluff.

OUTPUT JSON ONLY (no prose):
{ "intent":"invoice" | "reminder",
  "toEmail":"", "subject":"", "textBody":"",
  "total": number, "dueISO":"", "paymentLink":"{{PAYMENT_LINK}}"
}
If input suggests a reminder (overdue), set intent to "reminder" and adjust tone slightly firmer but polite.
  </script>

  <script id="prSalesCloser" type="text/plain">
You are {{AGENT_NAME}}, a sales closer for {{BIZ_NAME}}.
Goal: convert warm leads to a booked call or paid order.

Context inputs: lead name, last interaction, offer {{OFFER_SNIPPET}}, CTA {{CTA_URL}}.
Strategy:
- If no reply: send Nudge A, then Nudge B after {{FOLLOWUP_GAP_HOURS}} hours.
- If objection (price/timing/fit), answer briefly with one strong benefit and exactly one CTA link.
- If ready, ask for a call time (2 slots) or link directly to checkout.

OUTPUT JSON ONLY:
{ "to":"", "channel":"sms|email", "subject":"", "textBody":"", "nextFollowupHours": {{FOLLOWUP_GAP_HOURS}}, "stage":"A|B|Close" }
Keep copy short and human. No emojis unless the lead uses them.
  </script>

  <script id="prLeadQualifier" type="text/plain">
You are {{AGENT_NAME}}, a lead qualifier for {{BIZ_NAME}}.
Qualify leads and route them according to {{QUAL_RULES}}.

Collect or use:
name, email, phone, company, budget, timeline, service need, location.

OUTPUT JSON ONLY:
{ "score": 0-100, "tier":"A|B|C", "reason":"", "recommendedNext":"book_call|nurture|reject",
  "emailToLead": {"subject":"","textBody":""},
  "emailToOwner": {"subject":"","textBody":""}
}
Terse, friendly, zero fluff. Reasons should be one sentence.
  </script>

  <script id="prDMResponder" type="text/plain">
You are {{AGENT_NAME}}, a DM responder for {{BIZ_NAME}}.
Reply to IG/TikTok DMs with short, human messages that move users to {{PRIMARY_CTA}} (link: {{BOOK_URL}}).
If complex product questions arise, answer briefly and point to {{FAQ_URL}}.

OUTPUT JSON ONLY:
{"reply":"", "suggestedTag":"lead|customer|spam"}

One or two lines max. No emojis unless user uses them first.
  </script>
  <!-- ====== /AGENT PROMPTS ====== -->

  <!-- ====== NEW: AGENT TEMPLATES (n8n WORKFLOWS) ====== -->
  <script id="tplAgentInvoice" type="application/json">
{
  "name": "AI Invoice & Follow-ups",
  "nodes": [
    { "parameters": { "path": "invoice", "options": { "responseData": "={{$json}}" } }, "id": "1", "name": "Webhook (Create/Reminder)", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [240, 300] },
    { "parameters": { "functionCode": "const b=$json; return [{payload:b}];" }, "id": "2", "name": "Normalize", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [480, 300] },
    { "parameters": { "authentication": "none", "url": "https://api.openai.com/v1/chat/completions", "jsonParameters": true, "responseFormat": "json", "sendBody": true, "headerParametersJson": "{ \n  \"Authorization\": \"Bearer {{OPENAI_API_KEY}}\",\n  \"Content-Type\":\"application/json\"\n}", "bodyParametersJson": "={\n  \"model\":\"{{OPENAI_MODEL}}\",\n  \"temperature\":0.3,\n  \"messages\":[\n    {\"role\":\"system\",\"content\":\"YOU_ARE_INVOICE_ASSISTANT\"},\n    {\"role\":\"user\",\"content\": JSON.stringify($json.payload) }\n  ]\n}" }, "id": "3", "name": "OpenAI - Draft Invoice/Reminder", "type": "n8n-nodes-base.httpRequest", "typeVersion": 4, "position": [720, 300] },
    { "parameters": { "functionCode": "const c=$json.choices?.[0]?.message?.content?.trim()||\"\"; let p; try{p=JSON.parse(c);}catch(e){p={intent:\"invoice\",toEmail:\"\",subject:\"Invoice\",textBody:c,total:0};} return [p];" }, "id": "4", "name": "Parse JSON", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [960, 300] },
    { "parameters": { "fromEmail": "{{SMTP_FROM}}", "toEmail": "={{$json.toEmail}}", "subject": "={{$json.subject}}", "text": "={{$json.textBody}}" }, "id": "5", "name": "Send Email", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [1180, 200], "credentials": { "smtp": { "id": "{{SMTP_CRED_ID}}", "name": "SMTP" } } },
    { "parameters": { "operation": "create", "base": "{{AIRTABLE_BASE_ID}}", "table": "{{AIRTABLE_TABLE}}", "fieldsUi": { "field": [ { "fieldId": "Client", "fieldValue": "={{$json.toEmail}}" }, { "fieldId": "Subject", "fieldValue": "={{$json.subject}}" }, { "fieldId": "Total", "fieldValue": "={{$json.total}}"}, { "fieldId": "DueISO", "fieldValue": "={{$json.dueISO}}"}, { "fieldId": "PaymentLink", "fieldValue": "={{$json.paymentLink}}"} ] } }, "id": "6", "name": "Log to Airtable", "type": "n8n-nodes-base.airtable", "typeVersion": 2, "position": [1180, 400], "credentials": { "airtableApi": { "id": "{{AIRTABLE_CRED_ID}}", "name": "Airtable API" } } },
    { "parameters": { "responseBody": "={{$json}}", "responseCode": 200 }, "id": "7", "name": "Return", "type": "n8n-nodes-base.respondToWebhook", "typeVersion": 1, "position": [1400, 300] }
  ],
  "connections": {
    "Webhook (Create/Reminder)": { "main": [ [ { "node": "Normalize", "type": "main", "index": 0 } ] ] },
    "Normalize": { "main": [ [ { "node": "OpenAI - Draft Invoice/Reminder", "type": "main", "index": 0 } ] ] },
    "OpenAI - Draft Invoice/Reminder": { "main": [ [ { "node": "Parse JSON", "type": "main", "index": 0 } ] ] },
    "Parse JSON": { "main": [ [ { "node": "Send Email", "type": "main", "index": 0 } ], [ { "node": "Log to Airtable", "type": "main", "index": 0 } ], [ { "node": "Return", "type": "main", "index": 0 } ] ] },
    "Send Email": { "main": [ [ { "node": "Return", "type": "main", "index": 0 } ] ] },
    "Log to Airtable": { "main": [ [ { "node": "Return", "type": "main", "index": 0 } ] ] }
  },
  "active": false
}
  </script>

  <script id="tplAgentSalesCloser" type="application/json">
{
  "name": "AI Sales Closer",
  "nodes": [
    { "parameters": { "path": "closer", "options": { "responseData": "={{$json}}" } }, "id": "1", "name": "Webhook (New Lead/Reply)", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [240, 300] },
    { "parameters": { "functionCode": "return [{$json}];" }, "id": "2", "name": "Pass", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [480, 300] },
    { "parameters": { "url": "https://api.openai.com/v1/chat/completions", "jsonParameters": true, "sendBody": true, "responseFormat": "json", "headerParametersJson": "{ \"Authorization\":\"Bearer {{OPENAI_API_KEY}}\",\"Content-Type\":\"application/json\"}", "bodyParametersJson": "={\"model\":\"{{OPENAI_MODEL}}\",\"temperature\":0.4,\"messages\":[{\"role\":\"system\",\"content\":\"YOU_ARE_SALES_CLOSER\"},{\"role\":\"user\",\"content\": JSON.stringify($json)}]}" }, "id": "3", "name": "OpenAI - Draft Reply", "type": "n8n-nodes-base.httpRequest", "typeVersion": 4, "position": [720, 300] },
    { "parameters": { "functionCode": "const s=$json.choices?.[0]?.message?.content?.trim()||\"\"; let p; try{p=JSON.parse(s);}catch(e){p={to:\"\",channel:\"sms\",textBody:s,subject:\"\"}} return [p];" }, "id": "4", "name": "Parse JSON", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [960, 300] },
    { "parameters": { "conditions": { "string": [ { "value1": "={{$json.channel}}", "operation": "equal", "value2": "sms" } ] } }, "id": "5", "name": "IF SMS?", "type": "n8n-nodes-base.if", "typeVersion": 1, "position": [1180, 260] },
    { "parameters": { "from": "{{TWILIO_FROM}}", "to": "={{$json.to}}", "message": "={{$json.textBody}}" }, "id": "6", "name": "Twilio - Send SMS", "type": "n8n-nodes-base.twilio", "typeVersion": 1, "position": [1400, 140], "credentials": { "twilioApi": { "id": "{{TWILIO_CRED_ID}}", "name": "Twilio" } } },
    { "parameters": { "fromEmail": "{{SMTP_FROM}}", "toEmail": "={{$json.to}}", "subject": "={{$json.subject}}", "text": "={{$json.textBody}}" }, "id": "7", "name": "Email - Send", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [1400, 380], "credentials": { "smtp": { "id": "{{SMTP_CRED_ID}}", "name": "SMTP" } } },
    { "parameters": { "operation": "create", "base": "{{AIRTABLE_BASE_ID}}", "table": "{{AIRTABLE_TABLE}}", "fieldsUi": { "field": [ { "fieldId": "To", "fieldValue": "={{$json.to}}" }, { "fieldId": "Channel", "fieldValue": "={{$json.channel}}" }, { "fieldId": "Stage", "fieldValue": "={{$json.stage}}" }, { "fieldId": "NextFollowupHours", "fieldValue": "={{$json.nextFollowupHours}}" } ] } }, "id": "8", "name": "Log to Airtable", "type": "n8n-nodes-base.airtable", "typeVersion": 2, "position": [1620, 260], "credentials": { "airtableApi": { "id": "{{AIRTABLE_CRED_ID}}", "name": "Airtable API" } } },
    { "parameters": { "responseBody": "={{$json}}", "responseCode": 200 }, "id": "9", "name": "Return", "type": "n8n-nodes-base.respondToWebhook", "typeVersion": 1, "position": [1840, 260] }
  ],
  "connections": {
    "Webhook (New Lead/Reply)": { "main": [ [ { "node": "Pass", "type": "main", "index": 0 } ] ] },
    "Pass": { "main": [ [ { "node": "OpenAI - Draft Reply", "type": "main", "index": 0 } ] ] },
    "OpenAI - Draft Reply": { "main": [ [ { "node": "Parse JSON", "type": "main", "index": 0 } ] ] },
    "Parse JSON": {
      "main": [
        [ { "node": "IF SMS?", "type": "main", "index": 0 } ],
        [ { "node": "Email - Send", "type": "main", "index": 0 } ],
        [ { "node": "Log to Airtable", "type": "main", "index": 0 } ],
        [ { "node": "Return", "type": "main", "index": 0 } ]
      ]
    },
    "IF SMS?": {
      "main": [
        [ { "node": "Twilio - Send SMS", "type": "main", "index": 0 } ],
        [ { "node": "Email - Send", "type": "main", "index": 0 } ]
      ]
    },
    "Twilio - Send SMS": { "main": [ [ { "node": "Log to Airtable", "type": "main", "index": 0 } ] ] },
    "Email - Send": { "main": [ [ { "node": "Log to Airtable", "type": "main", "index": 0 } ] ] },
    "Log to Airtable": { "main": [ [ { "node": "Return", "type": "main", "index": 0 } ] ] }
  },
  "active": false
}
  </script>

  <script id="tplAgentLeadQualifier" type="application/json">
{
  "name": "AI Lead Qualifier",
  "nodes": [
    { "parameters": { "path": "lead", "options": { "responseData": "={{$json}}" } }, "id": "1", "name": "Webhook (Lead In)", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [240, 300] },
    { "parameters": { "functionCode": "return [{$json}];" }, "id": "2", "name": "Pass", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [480, 300] },
    { "parameters": { "url": "https://api.openai.com/v1/chat/completions", "jsonParameters": true, "sendBody": true, "responseFormat": "json", "headerParametersJson": "{ \"Authorization\":\"Bearer {{OPENAI_API_KEY}}\",\"Content-Type\":\"application/json\"}", "bodyParametersJson": "={\"model\":\"{{OPENAI_MODEL}}\",\"temperature\":0.2,\"messages\":[{\"role\":\"system\",\"content\":\"YOU_ARE_LEAD_QUALIFIER\"},{\"role\":\"user\",\"content\": JSON.stringify($json)}]}" }, "id": "3", "name": "OpenAI - Qualify", "type": "n8n-nodes-base.httpRequest", "typeVersion": 4, "position": [720, 300] },
    { "parameters": { "functionCode": "const t=$json.choices?.[0]?.message?.content?.trim()||\"\"; let p; try{p=JSON.parse(t);}catch(e){p={score:50,tier:\"B\",reason:t,recommendedNext:\"nurture\"}} return [p];" }, "id": "4", "name": "Parse JSON", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [960, 300] },
    { "parameters": { "conditions": { "string": [ { "value1": "={{$json.recommendedNext}}", "operation": "equal", "value2": "book_call" } ] } }, "id": "5", "name": "IF Book Call", "type": "n8n-nodes-base.if", "typeVersion": 1, "position": [1180, 240] },
    { "parameters": { "fromEmail": "{{SMTP_FROM}}", "toEmail": "={{$json.emailToLead?.to || $json.lead?.email || \"\"}}", "subject": "={{$json.emailToLead.subject}}", "text": "={{$json.emailToLead.textBody}}" }, "id": "6", "name": "Email Lead", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [1400, 140], "credentials": { "smtp": { "id": "{{SMTP_CRED_ID}}", "name": "SMTP" } } },
    { "parameters": { "fromEmail": "{{SMTP_FROM}}", "toEmail": "{{BIZ_EMAIL}}", "subject": "={{$json.emailToOwner.subject}}", "text": "={{$json.emailToOwner.textBody}}" }, "id": "7", "name": "Email Owner", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [1400, 300], "credentials": { "smtp": { "id": "{{SMTP_CRED_ID}}", "name": "SMTP" } } },
    { "parameters": { "operation": "create", "base": "{{AIRTABLE_BASE_ID}}", "table": "{{AIRTABLE_TABLE}}", "fieldsUi": { "field": [ { "fieldId": "Score", "fieldValue": "={{$json.score}}" }, { "fieldId": "Tier", "fieldValue": "={{$json.tier}}" }, { "fieldId": "Reason", "fieldValue": "={{$json.reason}}" }, { "fieldId": "Next", "fieldValue": "={{$json.recommendedNext}}" } ] } }, "id": "8", "name": "Log to Airtable", "type": "n8n-nodes-base.airtable", "typeVersion": 2, "position": [1620, 240], "credentials": { "airtableApi": { "id": "{{AIRTABLE_CRED_ID}}", "name": "Airtable API" } } },
    { "parameters": { "responseBody": "={{$json}}", "responseCode": 200 }, "id": "9", "name": "Return", "type": "n8n-nodes-base.respondToWebhook", "typeVersion": 1, "position": [1840, 240] }
  ],
  "connections": {
    "Webhook (Lead In)": { "main": [ [ { "node": "Pass", "type": "main", "index": 0 } ] ] },
    "Pass": { "main": [ [ { "node": "OpenAI - Qualify", "type": "main", "index": 0 } ] ] },
    "OpenAI - Qualify": { "main": [ [ { "node": "Parse JSON", "type": "main", "index": 0 } ] ] },
    "Parse JSON": { "main": [ [ { "node": "IF Book Call", "type": "main", "index": 0 } ], [ { "node": "Email Owner", "type": "main", "index": 0 } ], [ { "node": "Log to Airtable", "type": "main", "index": 0 } ], [ { "node": "Return", "type": "main", "index": 0 } ] ] },
    "IF Book Call": { "main": [ [ { "node": "Email Lead", "type": "main", "index": 0 } ] ] },
    "Email Lead": { "main": [ [ { "node": "Log to Airtable", "type": "main", "index": 0 } ] ] },
    "Email Owner": { "main": [ [ { "node": "Log to Airtable", "type": "main", "index": 0 } ] ] },
    "Log to Airtable": { "main": [ [ { "node": "Return", "type": "main", "index": 0 } ] ] }
  },
  "active": false
}
  </script>

  <script id="tplAgentDMResponder" type="application/json">
{
  "name": "AI DM Responder",
  "nodes": [
    { "parameters": { "path": "dm-responder", "options": { "responseData": "={{$json}}" } }, "id":"1","name":"Webhook (DM)","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[240,300]},
    { "parameters": { "functionCode": "return [{$json}];" }, "id":"2","name":"Pass","type":"n8n-nodes-base.function","typeVersion":2,"position":[480,300]},
    { "parameters": { "url": "https://api.openai.com/v1/chat/completions","jsonParameters": true,"sendBody": true,"responseFormat":"json","headerParametersJson":"{\"Authorization\":\"Bearer {{OPENAI_API_KEY}}\",\"Content-Type\":\"application/json\"}","bodyParametersJson":"={\"model\":\"{{OPENAI_MODEL}}\",\"temperature\":0.5,\"messages\":[{\"role\":\"system\",\"content\":\"YOU_ARE_DM_RESPONDER\"},{\"role\":\"user\",\"content\": JSON.stringify($json)}]}" }, "id":"3","name":"OpenAI - DM Reply","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[720,300]},
    { "parameters": { "functionCode": "const s=$json.choices?.[0]?.message?.content?.trim()||\"\"; let p; try{p=JSON.parse(s);}catch(e){p={reply:s,suggestedTag:\"lead\"}} return [p];" }, "id":"4","name":"Parse JSON","type":"n8n-nodes-base.function","typeVersion":2,"position":[960,300]},
    { "parameters": { "url": "{{PLATFORM_REPLY_WEBHOOK}}", "jsonParameters": true, "options": {}, "sendBody": true, "bodyParametersJson": "={\"conversationId\": $json.conversationId || \"\", \"reply\": $json.reply }" }, "id":"5","name":"HTTP - Send Reply to Platform","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[1180,220]},
    { "parameters": { "operation": "create", "base": "{{AIRTABLE_BASE_ID}}", "table": "{{AIRTABLE_TABLE}}", "fieldsUi": { "field": [ { "fieldId": "ConversationId", "fieldValue": "={{$json.conversationId}}"}, { "fieldId": "Reply", "fieldValue": "={{$json.reply}}"}, { "fieldId": "Tag", "fieldValue": "={{$json.suggestedTag}}"} ] } }, "id":"6","name":"Airtable - Log","type":"n8n-nodes-base.airtable","typeVersion":2,"position":[1180,380], "credentials":{"airtableApi":{"id":"{{AIRTABLE_CRED_ID}}","name":"Airtable API"}}},
    { "parameters": { "responseBody":"={{$json}}","responseCode":200 }, "id":"7","name":"Return","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[1400,300]}
  ],
  "connections": {
    "Webhook (DM)": { "main": [ [ { "node": "Pass", "type": "main", "index": 0 } ] ] },
    "Pass": { "main": [ [ { "node": "OpenAI - DM Reply", "type": "main", "index": 0 } ] ] },
    "OpenAI - DM Reply": { "main": [ [ { "node": "Parse JSON", "type": "main", "index": 0 } ] ] },
    "Parse JSON": { "main": [ [ { "node": "HTTP - Send Reply to Platform", "type": "main", "index": 0 } ], [ { "node": "Airtable - Log", "type": "main", "index": 0 } ], [ { "node": "Return", "type": "main", "index": 0 } ] ] },
    "HTTP - Send Reply to Platform": { "main": [ [ { "node": "Return", "type": "main", "index": 0 } ] ] },
    "Airtable - Log": { "main": [ [ { "node": "Return", "type": "main", "index": 0 } ] ] }
  },
  "active": false
}
  </script>
  <!-- ====== /AGENT TEMPLATES ====== -->

  <!-- Binder + Router -->
  <script>
  (function(){
    const $ = (id)=>document.getElementById(id);

    /* ---------------- DEMO CHAT ---------------- */
    function addMsg(role, text){
      const wrap = $('chatBox'); if(!wrap) return;
      const row = document.createElement('div');
      row.className = 'flex gap-3';
      if(role==='user'){ row.className += ' justify-end'; }
      row.innerHTML = role==='user'
        ? `<div class="max-w-[75%] bg-brand-500/20 rounded-xl px-3 py-2">${escapeHtml(text)}</div>`
        : `<div class="w-8 h-8 rounded-full bg-brand-500 grid place-items-center">ü§ñ</div><div class="max-w-[75%] bg-white/5 rounded-xl px-3 py-2">${escapeHtml(text)}</div>`;
      wrap.appendChild(row);
      wrap.scrollTop = wrap.scrollHeight;
    }
    function escapeHtml(s){return (s||'').replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" }[m]))}
    function wireChat(){
      const form=$('chatForm'), input=$('chatInput');
      if(!form || !input) return;
      form.addEventListener('submit',(e)=>{
        e.preventDefault();
        const t=input.value.trim(); if(!t) return;
        addMsg('user', t);
        input.value='';
        setTimeout(()=>addMsg('bot', "Thanks! (Demo chat only) ‚Äî the real receptionist runs in your n8n workflows."), 400);
      });
      $('chatSend')?.addEventListener('click',()=>form.requestSubmit());
    }

    /* -------------- FORM & PROMPT -------------- */
    function getValues(){
      const form = $('aiForm'); if(!form) return {};
      const v = Object.fromEntries(new FormData(form).entries());
      try{ v.timezone ||= Intl.DateTimeFormat().resolvedOptions().timeZone || ""; }catch{}
      v.agentName ||= 'Alex'; v.language ||= 'English';
      return v;
    }
    const truncate=(s,n=1200)=> s && s.length>n ? s.slice(0,n)+' ‚Ä¶' : (s||'');

    function buildPrompt(v={}){
      const tz=v.timezone||'America/New_York', biz=v.bizName||'the business', agent=v.agentName||'Alex';
      const industry=v.industry||'services', services=v.services||'General services', hours=v.hours||'Mon‚ÄìFri 9:00‚Äì17:00';
      const location=v.location||'Local area', policies=v.policies||'Standard policies apply.', emailFrom=v.email||'no-reply@example.com';
      const now=(()=>{try{return new Date().toLocaleString('en-US',{timeZone:tz,weekday:'long',year:'numeric',month:'long',day:'2-digit',hour:'2-digit',minute:'2-digit'})}catch{return new Date().toLocaleString()}})();
      const L=(x,l)=>`${l}: ${x||'N/A'}`;
      return [
`# ROLE
You are ${agent}, a friendly, efficient AI receptionist for **${biz}** (${industry}). Keep replies to 1‚Äì2 sentences, natural and clear.

# CURRENT TIME
- Current time: **${now}**
- Timezone: **${tz}**
Use ISO 8601 timestamps when interacting with tools.

# BUSINESS CONTEXT
${L(biz,'Business')}
${L(location,'Location / Service')}
${L(industry,'Industry')}
${L(services,'Services')}
${L(hours,'Hours')}
${L(policies,'Policies')}

# TASK
Answer questions and help book appointments quickly.

# BOOKING FLOW
1) Ask for the preferred date/time (within ${hours}).
2) Check the requested slot.
3) If unavailable, propose up to 3 close alternatives (same day or next business day).
4) Collect full name, email, phone.
5) Confirm slot and create the booking.
6) Summarize details and say a confirmation will be sent from **${emailFrom}**.

# STYLE & RULES
Warm, concise, confident; use contractions. Don‚Äôt invent availability outside ${hours}. Confirm final date/time + contact details.`
      ].join('\n');
    }
    function wirePromptDownload(){
      const btn = $('downloadPromptBtn'); if(!btn) return;
      btn.disabled = false;
      btn.onclick = (e)=>{
        e.preventDefault();
        const txt = buildPrompt(getValues());
        const a = document.createElement('a');
        a.href = URL.createObjectURL(new Blob([txt], { type:'text/plain;charset=utf-8' }));
        a.download = `${(getValues().bizName || 'AI_Receptionist')}_prompt.txt`;
        a.click(); URL.revokeObjectURL(a.href);
        flashOk('Prompt downloaded ‚úÖ');
      };
    }
    function flashOk(msg){
      const ok=$('successMsg'); if(!ok) return;
      ok.textContent = msg; ok.classList.remove('hidden');
      clearTimeout(ok._t); ok._t=setTimeout(()=>ok.classList.add('hidden'),2000);
    }

    /* -------------- JSON TEMPLATING (RECEPTIONIST) -------------- */
    function readTplObject(id){
      const node=$(id);
      if(!node){ const n=$('notice'); if(n) n.textContent=`Template "${id}" is missing.`; throw new Error('Missing template node: '+id); }
      const text=node.textContent??'';
      if(!text.trim()){ const n=$('notice'); if(n) n.textContent=`Template "${id}" is empty.`; throw new Error('Empty template: '+id); }
      return JSON.parse(text);
    }
    const slug=(s)=> (s||'').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'').slice(0,48)||'biz';
    function setWorkflowTimezone(obj, tz){ obj.settings=obj.settings||{}; obj.settings.timezone = tz || obj.settings.timezone || 'America/New_York'; }
    function patchCalendarToolNode(obj, idOrPrimary){
      (obj.nodes||[]).forEach(n=>{
        if(n?.type==='n8n-nodes-base.googleCalendarTool' && n.parameters?.calendar && typeof n.parameters.calendar==='object'){
          n.parameters.calendar.value = idOrPrimary;
          n.parameters.calendar.cachedResultName = idOrPrimary;
        }
      });
    }
    function patchWebhookPath(obj, newPath){
      (obj.nodes||[]).forEach(n=>{
        if(n?.type==='n8n-nodes-base.webhook' && n.parameters){ n.parameters.path = newPath || n.parameters.path; }
      });
    }
    function renderWorkflow(tplId, v, kind){
      const obj=readTplObject(tplId);
      setWorkflowTimezone(obj, v.timezone);
      patchCalendarToolNode(obj, v.calendarId || 'primary');
      const base = 'aos-'+slug(v.bizName);
      patchWebhookPath(obj, kind==='book' ? `${base}-book` : `${base}-check`);
      return JSON.stringify(obj, null, 2);
    }
    function enableDownload(btnId, text, name){
      const btn=$(btnId); if(!btn) return;
      btn.disabled=false; btn.onclick=(e)=>{
        e.preventDefault();
        const a=document.createElement('a');
        a.href=URL.createObjectURL(new Blob([text],{type:'application/json'}));
        a.download=name; a.click(); URL.revokeObjectURL(a.href);
        flashOk(name+' downloaded ‚úÖ');
      };
    }

    /* -------------- AUDIO PLAYER -------------- */
    function fmt(s){ s = Math.max(0, s|0); const m=(s/60)|0, sec=(s%60)|0; return m+':'+(sec<10?'0':'')+sec; }
    function wireAudioUI(){
      const a=$('audio'), box=$('audioUI'); if(!a || !box) return;
      const btn=$('audioPlay'), seek=$('audioSeek'), t=$('audioTime'), d=$('audioDur');
      function sync(){
        if(!isFinite(a.duration)) return;
        d.textContent = fmt(a.duration);
        t.textContent = fmt(a.currentTime);
        const pct = a.currentTime / Math.max(1, a.duration) * 100;
        seek.value = pct;
        seek.style.setProperty('--pct', pct+'%');
        btn.textContent = a.paused ? '‚ñ∂' : '‚è∏';
      }
      btn.addEventListener('click',()=>{ a.paused ? a.play() : a.pause(); });
      a.addEventListener('play', sync);
      a.addEventListener('pause', sync);
      a.addEventListener('timeupdate', sync);
      a.addEventListener('loadedmetadata', ()=>{ box.classList.remove('hidden'); sync(); });
      seek.addEventListener('input', ()=>{
        const pct = parseFloat(seek.value||'0')/100;
        if(isFinite(a.duration)) a.currentTime = a.duration*pct;
        seek.style.setProperty('--pct', seek.value+'%');
      });
    }

    /* -------------- RECEPTIONIST ACTIONS -------------- */
    async function doPreview(){
      const spinner=$('previewSpinner'), btn=$('previewBtn'), out=$('promptOut');
      btn.disabled=true; spinner?.classList.remove('hidden');
      try{
        const v=getValues();
        out.textContent = (truncate(buildPrompt(v)));
        wirePromptDownload();
        const avail = renderWorkflow('tplCheckAvailability', v, 'check');
        const book  = renderWorkflow('tplBookAppointment',  v, 'book');
        enableDownload('downloadAvailBtn', avail, 'checkAvailability.json');
        enableDownload('downloadBookBtn',  book,  'bookAppointment.json');
        const n=$('notice'); if(n) n.textContent='Downloads ready. JSONs customized with your Calendar ID, Timezone, and unique webhook paths.';
      }catch(e){ console.error(e); alert('Error preparing downloads: '+e.message); }
      finally{ spinner?.classList.add('hidden'); btn.disabled=false; }
    }

    /* ---------- Voices + TTS ---------- */
    async function loadVoices() {
      const sel = $('voiceSelect'); if (!sel) return;
      try {
        const r = await fetch('/api/voices'); const j = await r.json();
        sel.innerHTML = '';
        if (j.ok && Array.isArray(j.data.voices) && j.data.voices.length) {
          j.data.voices.forEach(v => {
            const opt = document.createElement('option');
            opt.value = v.id; opt.textContent = v.name;
            sel.appendChild(opt);
          });
          return;
        }
      } catch {}
      sel.innerHTML = '';
      [
        { id:'', name:'Default' },
        { id:'56bWURjYFHyYyVf490Dp', name:'Emma' },
        { id:'UgBBYS2sOqTuMpoF3BR0', name:'Mark' }
      ].forEach(v=>{
        const opt=document.createElement('option');
        opt.value=v.id; opt.textContent=v.name; sel.appendChild(opt);
      });
    }

    async function doTTS(){
      const ttsBtn = $('ttsBtn'); if (ttsBtn) ttsBtn.disabled = true;
      const v=getValues();
      const voice_id = ($('voiceSelect')?.value)||'';
      const text=`Hey, this is ${v.agentName||'Alex'} with ${v.bizName||'your business'}. How can I help you today?`;

      async function call(body){
        const res = await fetch('/api/tts', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) });
        let data=null; try{ data=await res.json(); }catch{}
        if(!res.ok || !data?.ok){
          const msg = data?.message || `HTTP ${res.status}`;
          const code= data?.code || 'UNKNOWN';
          throw new Error(`[${code}] ${msg}`);
        }
        return data.data.audioBase64;
      }

      try{
        let audioB64;
        try{
          const body = { text }; if (voice_id) body.voice_id = voice_id;
          audioB64 = await call(body);
        }catch(e){
          if(String(e.message).includes('[UPSTREAM]')){
            audioB64 = await call({ text });
          } else { throw e; }
        }
        const a=$('audio');
        a.src = audioB64; a.load();
        $('audioDownload').href = audioB64;
        await a.play().catch(()=>{});
      }catch(e){
        console.error(e); alert('TTS failed: '+ e.message);
      } finally {
        if (ttsBtn) ttsBtn.disabled = false;
      }
    }

    // Receptionist events
    document.addEventListener('click',(ev)=>{
      if(ev.target.closest('#previewBtn')){ ev.preventDefault(); doPreview(); }
      if(ev.target.closest('#ttsBtn')){ ev.preventDefault(); doTTS(); }
    });

    /* ============================
       SPA ROUTER + AGENT DETAIL
       ============================ */
    const VIEW_HOME = document.getElementById('view-home');
    const VIEW_AGENT = document.getElementById('view-agent');

    const AGENTS = {
      invoice: {
        title: 'üßæ AI Invoice / Follow-ups',
        desc: 'Generate invoices + polite reminders and email them. Logs to Airtable.',
        promptId: 'prInvoice',
        tplId: 'tplAgentInvoice',
        fields: [
          {name:'bizName', label:'Business Name', req:true},
          {name:'agentName', label:'Agent Name', value:'Ava'},
          {name:'email', label:'Business Email (from)', req:true},
          {name:'timezone', label:'Timezone', value:'America/New_York'},
          {name:'openaiModel', label:'OpenAI Model', value:'gpt-4o-mini'},
          {name:'paymentLink', label:'Payment Link (Stripe/PayPal)', req:true},
          {name:'taxRules', label:'Tax Rules (optional)'},
          {name:'airtableBaseId', label:'Airtable Base ID'},
          {name:'airtableTable', label:'Airtable Table', value:'Invoices'},
          {name:'airtableCredId', label:'Airtable Credential ID'},
          {name:'smtpFrom', label:'SMTP From (no-reply@...)'},
          {name:'smtpCredId', label:'SMTP Credential ID'}
        ],
        map: (v)=>({
          BIZ_NAME:v.bizName, AGENT_NAME:v.agentName, BIZ_EMAIL:v.email, TIMEZONE:v.timezone,
          OPENAI_MODEL:v.openaiModel, PAYMENT_LINK:v.paymentLink, TAX_RULES_SNIPPET:v.taxRules||'',
          AIRTABLE_BASE_ID:v.airtableBaseId||'', AIRTABLE_TABLE:v.airtableTable||'Logs', AIRTABLE_CRED_ID:v.airtableCredId||'',
          SMTP_FROM:v.smtpFrom||'no-reply@example.com', SMTP_CRED_ID:v.smtpCredId||'SMTP_CREDENTIAL',
          OPENAI_API_KEY:'USE_N8N_CREDENTIALS'
        }),
        fileBase: 'invoice'
      },
      salesCloser: {
        title: 'üìà AI Sales Closer',
        desc: 'Objection-aware nudges via SMS/Email. Auto-logs follow-ups.',
        promptId: 'prSalesCloser',
        tplId: 'tplAgentSalesCloser',
        fields: [
          {name:'bizName', label:'Business Name', req:true},
          {name:'agentName', label:'Agent Name', value:'Ava'},
          {name:'email', label:'Business Email (from)', req:true},
          {name:'openaiModel', label:'OpenAI Model', value:'gpt-4o-mini'},
          {name:'offerSnippet', label:'Offer Snippet', req:true},
          {name:'ctaUrl', label:'CTA URL (checkout/booking)', req:true},
          {name:'followupGap', label:'Follow-up Gap (hours)', value:'24'},
          {name:'airtableBaseId', label:'Airtable Base ID'},
          {name:'airtableTable', label:'Airtable Table', value:'Sales'},
          {name:'airtableCredId', label:'Airtable Credential ID'},
          {name:'smtpFrom', label:'SMTP From (no-reply@...)'},
          {name:'smtpCredId', label:'SMTP Credential ID'},
          {name:'twilioFrom', label:'Twilio From +1...'},
          {name:'twilioCredId', label:'Twilio Credential ID'}
        ],
        map: (v)=>({
          BIZ_NAME:v.bizName, AGENT_NAME:v.agentName, BIZ_EMAIL:v.email,
          OPENAI_MODEL:v.openaiModel, OFFER_SNIPPET:v.offerSnippet, CTA_URL:v.ctaUrl,
          FOLLOWUP_GAP_HOURS:v.followupGap||'24',
          AIRTABLE_BASE_ID:v.airtableBaseId||'', AIRTABLE_TABLE:v.airtableTable||'Logs', AIRTABLE_CRED_ID:v.airtableCredId||'',
          SMTP_FROM:v.smtpFrom||'no-reply@example.com', SMTP_CRED_ID:v.smtpCredId||'SMTP_CREDENTIAL',
          TWILIO_FROM:v.twilioFrom||'', TWILIO_CRED_ID:v.twilioCredId||'',
          OPENAI_API_KEY:'USE_N8N_CREDENTIALS'
        }),
        fileBase:'salesCloser'
      },
      leadQualifier: {
        title: 'üìû AI Lead Qualifier',
        desc: 'Score & route leads (A/B/C). Email both lead & owner with next steps.',
        promptId: 'prLeadQualifier',
        tplId: 'tplAgentLeadQualifier',
        fields: [
          {name:'bizName', label:'Business Name', req:true},
          {name:'agentName', label:'Agent Name', value:'Ava'},
          {name:'email', label:'Owner/Team Email', req:true},
          {name:'openaiModel', label:'OpenAI Model', value:'gpt-4o-mini'},
          {name:'qualRules', label:'Qualifier Rules (A/B/C tiers)', value:'A: ready budget & timeline; B: missing one; C: mismatch'},
          {name:'airtableBaseId', label:'Airtable Base ID'},
          {name:'airtableTable', label:'Airtable Table', value:'Leads'},
          {name:'airtableCredId', label:'Airtable Credential ID'},
          {name:'smtpFrom', label:'SMTP From (no-reply@...)'},
          {name:'smtpCredId', label:'SMTP Credential ID'}
        ],
        map:(v)=>({
          BIZ_NAME:v.bizName, AGENT_NAME:v.agentName, BIZ_EMAIL:v.email,
          OPENAI_MODEL:v.openaiModel, QUAL_RULES:v.qualRules,
          AIRTABLE_BASE_ID:v.airtableBaseId||'', AIRTABLE_TABLE:v.airtableTable||'Logs', AIRTABLE_CRED_ID:v.airtableCredId||'',
          SMTP_FROM:v.smtpFrom||'no-reply@example.com', SMTP_CRED_ID:v.smtpCredId||'SMTP_CREDENTIAL',
          OPENAI_API_KEY:'USE_N8N_CREDENTIALS'
        }),
        fileBase:'leadQualifier'
      },
      dmResponder: {
        title: 'üí¨ AI DM Responder',
        desc: 'Short replies for IG/TikTok that push to your CTA. Tags & logs.',
        promptId: 'prDMResponder',
        tplId: 'tplAgentDMResponder',
        fields: [
          {name:'bizName', label:'Business Name', req:true},
          {name:'agentName', label:'Agent Name', value:'Ava'},
          {name:'email', label:'Owner/Team Email (for logs)', req:true},
          {name:'openaiModel', label:'OpenAI Model', value:'gpt-4o-mini'},
          {name:'platformWebhook', label:'Platform Reply Webhook (Make/Zapier)', req:true},
          {name:'bookUrl', label:'Booking URL', req:true},
          {name:'faqUrl', label:'FAQ URL'},
          {name:'airtableBaseId', label:'Airtable Base ID'},
          {name:'airtableTable', label:'Airtable Table', value:'DMs'},
          {name:'airtableCredId', label:'Airtable Credential ID'}
        ],
        map:(v)=>({
          BIZ_NAME:v.bizName, AGENT_NAME:v.agentName, BIZ_EMAIL:v.email,
          OPENAI_MODEL:v.openaiModel, PLATFORM_REPLY_WEBHOOK:v.platformWebhook,
          BOOK_URL:v.bookUrl, FAQ_URL:v.faqUrl||'', PRIMARY_CTA:'book',
          AIRTABLE_BASE_ID:v.airtableBaseId||'', AIRTABLE_TABLE:v.airtableTable||'Logs', AIRTABLE_CRED_ID:v.airtableCredId||'',
          OPENAI_API_KEY:'USE_N8N_CREDENTIALS'
        }),
        fileBase:'dmResponder'
      }
    };

    function getScriptText(id){
      const el = document.getElementById(id);
      if(!el) throw new Error('Missing node: '+id);
      return el.textContent || '';
    }
    function injectPlaceholders(str, map){
      return Object.entries(map).reduce((acc,[k,v])=> acc.replaceAll(`{{${k}}}`, String(v ?? '')), String(str));
    }
    function setDownload(anchor, filename, data, mime='application/octet-stream'){
      const blob = new Blob([data], { type: mime });
      const url = URL.createObjectURL(blob);
      anchor.href = url; anchor.download = filename;
    }

    function renderAgentForm(def){
      const f = $('agentForm'); f.innerHTML = '';
      def.fields.forEach(field=>{
        const wrap = document.createElement('div');
        wrap.innerHTML = `
          <label class="block text-sm text-white/70 mb-1">${field.label}${field.req? ' <span class="text-red-400">*</span>':''}</label>
          <input name="${field.name}" value="${field.value||''}" placeholder="${field.label}" class="w-full">
        `;
        f.appendChild(wrap);
      });
    }
    function readAgentVals(){
      const f = $('agentForm');
      return Object.fromEntries(new FormData(f).entries());
    }

    function buildAgent(def){
      const v = readAgentVals();
      // basic required check
      const missing = def.fields.filter(x=>x.req && !v[x.name]?.trim()).map(x=>x.label);
      if(missing.length) throw new Error('Missing: '+missing.join(', '));

      const map = def.map(v);

      // Prompt
      let prompt = getScriptText(def.promptId);
      prompt = injectPlaceholders(prompt, map);

      // JSON Template
      let tpl = getScriptText(def.tplId);
      // inject long prompt into sentinel
      const longForJSON = prompt.replace(/`/g, '\\`').replace(/\n/g, '\\n');
      tpl = tpl.replace(/YOU_ARE_[A-Z_]+/g, longForJSON);
      tpl = injectPlaceholders(tpl, map);

      return { prompt, json: JSON.stringify(JSON.parse(tpl), null, 2) };
    }

    function route(){
      const hash = location.hash || '#/';
      const m = hash.match(/^#\/agent\/([a-zA-Z0-9_-]+)$/);
      if(m){
        const key = m[1];
        const def = AGENTS[key];
        if(!def){ location.hash = '#/'; return; }
        // show agent detail
        VIEW_HOME.classList.add('hidden');
        VIEW_AGENT.classList.remove('hidden');
        $('agentTitle').textContent = def.title;
        $('agentDesc').textContent = def.desc;
        renderAgentForm(def);
        $('agentPromptPreview').textContent = '';

        // wire actions
        $('agentGenerate').onclick = (e)=>{
          e.preventDefault();
          try{
            const out = buildAgent(def);
            $('agentPromptPreview').textContent = out.prompt;
            setDownload($('agentPromptDownload'), `${def.fileBase}-FULL-PROMPT.txt`, out.prompt, 'text/plain');
            setDownload($('agentJsonDownload'), `${def.fileBase}-workflow.json`, out.json, 'application/json');
            const ok = $('agentMsg'); ok.classList.remove('hidden'); setTimeout(()=>ok.classList.add('hidden'), 1500);
          }catch(err){ alert(err.message); }
        };
        $('agentPromptDownload').onclick = (e)=>{ if(!$('agentPromptPreview').textContent) e.preventDefault(); };
        $('agentJsonDownload').onclick = (e)=>{ if(!$('agentPromptPreview').textContent) e.preventDefault(); };
      } else {
        // home
        VIEW_AGENT.classList.add('hidden');
        VIEW_HOME.classList.remove('hidden');
      }
    }

    // events
    window.addEventListener('hashchange', route);

    // init
    function init(){ wireChat(); wireAudioUI(); loadVoices(); route(); }
    if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', init); else init();

    /* Receptionist "Generate Preview" binding */
    document.addEventListener('click',(ev)=>{
      if(ev.target.closest('#previewBtn')){ ev.preventDefault(); doPreview(); }
      if(ev.target.closest('#ttsBtn')){ ev.preventDefault(); doTTS(); }
    });

  })();
  </script>
</body>
</html>
