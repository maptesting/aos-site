<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>AOS â€“ Instant AI Receptionist Builder</title>
  <meta name="description" content="Generate a custom AI receptionist for any business in minutes. Preview a production-ready System Prompt and download import-ready n8n workflows for check_availability and book_appointment. Hear a voice intro with ElevenLabs." />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ¤–</text></svg>">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {50:"#f5f8ff",100:"#eaf0ff",200:"#cfdcff",300:"#a5baff",400:"#7991ff",500:"#556dff",600:"#3d4fe6",700:"#2f3bb4",800:"#222a82",900:"#141a51"},
            ink:"#0b0f1a"
          },
          boxShadow:{ soft:"0 8px 30px rgba(0,0,0,.18)" }
        }
      }
    }
  </script>
  <style>
    .glass { backdrop-filter: blur(10px); background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.08); }
    .gradient { background: radial-gradient(1200px 600px at 20% -10%, rgba(85,109,255,.25), transparent 60%), radial-gradient(1000px 600px at 100% 0%, rgba(34,42,130,.35), transparent 60%), linear-gradient(180deg, #0b0f1a 0%, #0b0f1a 100%); }
    html { scroll-behavior: smooth; }
    .site-logo { width: 36px; height: 36px; object-fit: contain; border-radius: .75rem; }
    .code { white-space: pre-wrap; font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; }
    select, select option { background-color: rgba(255,255,255,.08)!important; color:#fff!important; }
    select:focus, input:focus, textarea:focus { outline: none; box-shadow: 0 0 0 2px rgba(85,109,255,.6); }
  </style>
</head>
<body class="bg-ink text-white antialiased selection:bg-brand-300/30">

  <!-- Top notice -->
  <div class="bg-brand-900/40 border-b border-white/10 text-sm">
    <div class="mx-auto max-w-7xl px-4 py-2 text-center">
      Build a custom AI receptionist for <b>any business</b> â€” free preview + downloads. Hear a voice intro with ElevenLabs.
      <a href="#builder" class="ml-2 underline decoration-brand-400 hover:text-brand-300">Start building â†’</a>
    </div>
  </div>

  <!-- Header -->
  <header class="sticky top-0 z-50 bg-ink/70 glass">
    <div class="mx-auto max-w-7xl px-4">
      <div class="flex h-16 items-center justify-between">
        <a href="#" class="flex items-center gap-3">
          <img src="images/logo/ChatGPT Image Oct 26, 2025, 04_40_34 PM.png" alt="AOS logo" class="site-logo" />
          <div class="leading-tight">
            <div class="font-semibold tracking-tight">AOS</div>
            <div class="text-xs text-white/60">AI Optimization Solutions</div>
          </div>
        </a>
        <nav class="hidden md:flex items-center gap-8 text-sm">
          <a href="#features" class="hover:text-brand-300">Features</a>
          <a href="#builder" class="hover:text-brand-300">AI Builder</a>
          <a href="#faq" class="hover:text-brand-300">FAQ</a>
        </nav>
        <div class="flex items-center gap-3">
          <a href="#builder" class="inline-flex text-sm px-4 py-2 rounded-xl bg-brand-500 hover:bg-brand-600">Build Free</a>
        </div>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section class="relative gradient overflow-hidden">
    <div class="mx-auto max-w-7xl px-4 pt-16 pb-24 md:pt-24 md:pb-28">
      <div class="grid md:grid-cols-2 gap-10 items-center">
        <div>
          <div class="inline-flex items-center gap-2 rounded-full border border-white/10 px-3 py-1 text-xs text-white/70 mb-5">
            <span>ðŸ¤– Instant AI Receptionist Builder</span><span class="opacity-30">â€¢</span><span>Any Business â€¢ Any Country</span>
          </div>
          <h1 class="text-4xl md:text-6xl font-extrabold tracking-tight leading-tight">
            Turn inquiries into <span class="text-brand-400">booked customers</span>â€”automatically.
          </h1>
          <p class="mt-5 text-white/70 max-w-xl">
            Answer a few questions about your business. Get a tailored System Prompt (preview) and download two import-ready n8n workflows:
            <em>check_availability</em> and <em>book_appointment</em>. Works with your favorite LLM + n8n stack.
          </p>
          <div class="mt-8 flex flex-wrap gap-3">
            <a href="#builder" class="px-5 py-3 rounded-xl bg-brand-500 hover:bg-brand-600 font-medium">Build now</a>
          </div>
        </div>

        <div class="relative">
          <div class="glass rounded-2xl p-6 md:p-8 shadow-soft">
            <div class="text-sm text-white/60">Live conversation</div>
            <div class="mt-3 space-y-3">
              <div class="flex items-start gap-3">
                <div class="h-9 w-9 rounded-full bg-brand-500 grid place-items-center">ðŸ¤–</div>
                <div class="flex-1 text-sm"><span class="text-white/70">AI:</span> Hi! What can I help you with today?</div>
              </div>
              <div class="flex items-start gap-3">
                <div class="h-9 w-9 rounded-full bg-white/10 grid place-items-center">ðŸ‘¤</div>
                <div class="flex-1 text-sm">I need pricing and earliest availability.</div>
              </div>
              <div class="flex items-start gap-3">
                <div class="h-9 w-9 rounded-full bg-brand-500 grid place-items-center">ðŸ¤–</div>
                <div class="flex-1 text-sm">We can do tomorrow at <strong>2:00 PM</strong>. Whatâ€™s your full name, email, and phone?</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Features -->
  <section id="features" class="py-20 md:py-28">
    <div class="mx-auto max-w-7xl px-4">
      <h2 class="text-3xl md:text-4xl font-bold tracking-tight">Built for any business, anywhere.</h2>
      <p class="mt-3 text-white/70 max-w-2xl">The AI receptionist collects details, quotes ranges, schedules, confirms, and hands off to a human when needed.</p>
      <div class="mt-10 grid md:grid-cols-3 gap-6">
        <div class="glass rounded-2xl p-6"><h3 class="font-semibold">ðŸ“ž Missed inquiry recovery</h3><p class="mt-2 text-white/70 text-sm">Instant responses by web, SMS, or chat widget.</p></div>
        <div class="glass rounded-2xl p-6"><h3 class="font-semibold">ðŸ“… Calendar & CRM ready</h3><p class="mt-2 text-white/70 text-sm">Google Calendar node pre-wired (connect your creds).</p></div>
        <div class="glass rounded-2xl p-6"><h3 class="font-semibold">ðŸ§  Trained on your info</h3><p class="mt-2 text-white/70 text-sm">Your services, prices, policies, and toneâ€”no code.</p></div>
      </div>
    </div>
  </section>

  <!-- AI BUILDER -->
  <section id="builder" class="py-20 md:py-28">
    <div class="mx-auto max-w-6xl px-4">
      <div class="glass rounded-2xl p-6 md:p-10">
        <div class="flex items-start justify-between gap-8 flex-col lg:flex-row">
          <!-- Form -->
          <div class="w-full lg:w-1/2">
            <h2 class="text-3xl font-bold tracking-tight">Build your AI Receptionist</h2>
            <p class="mt-2 text-white/70">Preview the System Prompt, hear an ElevenLabs voice intro, and download two n8n workflow JSONs.</p>

            <form id="aiForm" class="grid gap-3 mt-6">
              <div class="grid md:grid-cols-2 gap-3">
                <input class="rounded-xl bg-white/5 border border-white/10 px-4 py-3 placeholder-white/40" placeholder="Business name" name="bizName" required>
                <input class="rounded-xl bg-white/5 border border-white/10 px-4 py-3 placeholder-white/40" placeholder="Location / Service area" name="location" required>
              </div>

              <div class="grid md:grid-cols-2 gap-3">
                <input name="industry" class="rounded-xl bg-white/5 border border-white/10 px-4 py-3 placeholder-white/40" placeholder="Industry (e.g., Cleaning, SaaS, Clinic)" required>
                <input name="services" class="rounded-xl bg-white/5 border border-white/10 px-4 py-3 placeholder-white/40" placeholder="Core services (comma-separated)" required>
              </div>

              <div class="grid md:grid-cols-2 gap-3">
                <input name="agentName" class="rounded-xl bg-white/5 border border-white/10 px-4 py-3 placeholder-white/40" placeholder="Agent name (e.g., Alex)" value="Alex">
                <input name="language" class="rounded-xl bg-white/5 border border-white/10 px-4 py-3 placeholder-white/40" placeholder="Language (e.g., English, Spanish)" value="English">
              </div>

              <textarea name="pricing" rows="2" class="rounded-xl bg-white/5 border border-white/10 px-4 py-3 placeholder-white/40" placeholder="Typical price ranges or plans (optional)"></textarea>

              <div class="grid md:grid-cols-2 gap-3">
                <input name="hours" class="rounded-xl bg-white/5 border border-white/10 px-4 py-3 placeholder-white/40" placeholder="Hours (e.g., Monâ€“Sat 9â€“6)">
                <input name="calendarId" class="rounded-xl bg-white/5 border border-white/10 px-4 py-3 placeholder-white/40" placeholder="Google Calendar ID (e.g., owner@gmail.com)">
              </div>

              <div class="grid md:grid-cols-2 gap-3">
                <input name="email" type="email" class="rounded-xl bg-white/5 border border-white/10 px-4 py-3 placeholder-white/40" placeholder="Confirmation email sender">
                <input name="phone" inputmode="tel" class="rounded-xl bg-white/5 border border-white/10 px-4 py-3 placeholder-white/40" placeholder="Business phone (optional)">
              </div>

              <div class="grid md:grid-cols-2 gap-3">
                <input name="timezone" class="rounded-xl bg-white/5 border border-white/10 px-4 py-3 placeholder-white/40" placeholder="Timezone (e.g., America/New_York)">
                <textarea name="policies" rows="2" class="rounded-xl bg-white/5 border border-white/10 px-4 py-3 placeholder-white/40" placeholder="Deposits / refunds / service area / compliance (optional)"></textarea>
              </div>

              <div class="grid md:grid-cols-2 gap-3">
                <label class="flex items-center gap-2 text-sm"><input type="checkbox" name="upsell_a" class="accent-brand-500"> Offer upsells / add-ons</label>
                <label class="flex items-center gap-2 text-sm"><input type="checkbox" name="handoff" class="accent-brand-500" checked> Enable human handoff</label>
              </div>

              <div class="mt-4 flex flex-wrap gap-3">
                <button id="previewBtn" type="button" class="px-5 py-3 rounded-xl bg-brand-500 hover:bg-brand-600 font-medium">Generate Preview</button>
                <button id="ttsBtn" type="button" class="px-5 py-3 rounded-xl border border-white/10 hover:bg-white/5">â–¶ Hear AI Greeting (ElevenLabs)</button>
              </div>
            </form>
          </div>

          <!-- Preview -->
          <div class="w-full lg:w-1/2">
            <div class="glass rounded-2xl p-5 h-full">
              <h3 class="text-xl font-semibold">System Prompt â€” Preview</h3>
              <div class="text-xs text-white/60">Preview only (truncated)</div>
              <div class="mt-3">
                <div id="promptOut" class="code text-sm bg-black/30 rounded-xl p-4 border border-white/10 min-h-[200px]"></div>
              </div>

              <div class="mt-6">
                <h4 class="text-sm font-semibold text-white/80 mb-2">Downloads</h4>
                <div class="flex flex-wrap gap-2">
                  <button id="downloadPromptBtn" type="button" class="px-4 py-2 rounded-xl bg-brand-500/80 hover:bg-brand-600 font-medium disabled:opacity-50" disabled>Download Full Prompt (.txt)</button>
                  <button id="downloadAvailBtn" type="button" class="px-4 py-2 rounded-xl border border-white/10 hover:bg-white/5 disabled:opacity-50" disabled>Download: check_availability.n8n.json</button>
                  <button id="downloadBookBtn" type="button" class="px-4 py-2 rounded-xl border border-white/10 hover:bg-white/5 disabled:opacity-50" disabled>Download: book_appointment.n8n.json</button>
                </div>
              </div>

              <div class="mt-6">
                <h4 class="text-sm text-white/60 mb-2">Voice Preview</h4>
                <div id="audioWrap" class="hidden">
                  <audio id="audio" controls class="w-full"></audio>
                  <a id="audioDownload" download="ai-greeting.mp3" class="inline-block mt-2 text-sm underline decoration-brand-400">Download audio</a>
                </div>
              </div>

              <div id="notice" class="mt-4 text-xs text-white/60"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-6 text-center text-white/60 text-sm">
        Need a done-for-you install (multi-language, phone, SMS, CRM)? <a class="underline decoration-brand-400" href="https://calendly.com/razerrtrading/30min" target="_blank">Book a call</a>.
      </div>
    </div>
  </section>

  <!-- FAQ -->
  <section id="faq" class="py-20 md:py-28 bg-white/5">
    <div class="mx-auto max-w-4xl px-4">
      <h2 class="text-3xl font-bold tracking-tight text-center">FAQ</h2>
      <div class="mt-8 divide-y divide-white/10">
        <details class="group py-4">
          <summary class="flex justify-between cursor-pointer"><span>Does it work for any industry?</span><span class="transition group-open:rotate-180">âŒ„</span></summary>
          <p class="mt-2 text-white/70 text-sm">Yesâ€”fill in your services, prices, rules, and tone. The prompt adapts to clinics, trades, agencies, e-commerce, SaaS, and more.</p>
        </details>
        <details class="group py-4">
          <summary class="flex justify-between cursor-pointer"><span>How do I use the n8n JSON?</span><span class="transition group-open:rotate-180">âŒ„</span></summary>
          <p class="mt-2 text-white/70 text-sm">In n8n, go to <em>Import from File</em> or <em>Paste JSON</em>, then connect your credentials for Google Calendar and Email/SMTP after import.</p>
        </details>
      </div>
    </div>
  </section>

  <footer class="py-10 text-center text-white/40 text-sm">Â© <span id="year"></span> AOS â€” AI Optimization Solutions</footer>

  <script>
    // ------- Helpers -------
    document.getElementById('year').textContent = new Date().getFullYear();

    const form = document.getElementById('aiForm');
    const previewBtn = document.getElementById('previewBtn');
    const ttsBtn = document.getElementById('ttsBtn');
    const downloadPromptBtn = document.getElementById('downloadPromptBtn');
    const downloadAvailBtn = document.getElementById('downloadAvailBtn');
    const downloadBookBtn = document.getElementById('downloadBookBtn');
    const promptOut = document.getElementById('promptOut');
    const notice = document.getElementById('notice');
    const audioEl = document.getElementById('audio');
    const audioWrap = document.getElementById('audioWrap');
    const audioDownload = document.getElementById('audioDownload');

    // Default timezone to visitor's
    const tzGuess = Intl.DateTimeFormat().resolvedOptions().timeZone || "UTC";
    if (!form.timezone?.value && form.querySelector('[name="timezone"]')) form.querySelector('[name="timezone"]').value = tzGuess;

    function getValues() {
      const data = Object.fromEntries(new FormData(form).entries());
      data.upsells = form.upsell_a?.checked ? ["Relevant add-ons"] : [];
      data.handoff = !!form.handoff?.checked;
      if (!data.timezone) data.timezone = tzGuess;
      if (!data.language) data.language = "English";
      if (!data.agentName) data.agentName = "Alex";
      return data;
    }

    // Build full System Prompt
    function buildPrompt(v) {
      const upsellLine = v.upsells.length ? `Offer relevant add-ons when appropriate.` : "";
      const pricingLine = v.pricing
        ? `Use these price ranges to quote: ${v.pricing}. Do not invent numbers beyond these; if unsure, say you'll confirm.`
        : `Provide estimate ranges conservatively; confirm exact amounts before booking.`;
      const policies = v.policies ? `Policies to respect: ${v.policies}` : `Be courteous, concise, and transparent.`;
      const handoff = v.handoff ? `If conversation becomes complex or sensitive, route to a human immediately.` : ``;

      return `## Role:
You are the AI Receptionist (â€œ${v.agentName}â€) for "${v.bizName}", a ${v.industry} business in ${v.location}. Communicate in ${v.language}. You greet, qualify, check availability, and book.

## Current Time:
{{ "now" | date: "%A, %B %d, %Y, %I:%M %p", "${v.timezone}" }}

## Voice & Style:
Warm, professional, and concise (1â€“2 sentences). Natural human tone with light fillers (â€œsounds goodâ€, â€œno worriesâ€).

## Services You Handle:
${v.services}.

## Tools (use by name when needed):
- check_availability(time_requested) â†’ n8n webhook: ${v.whCheck || "[CHECK_AVAILABILITY_URL]"}
- book_appointment(full_name, email, phone_number, service_type, time) â†’ n8n webhook: ${v.whBook || "[BOOK_APPOINTMENT_URL]"}

## Task (3 steps):
1) Greet & Qualify
- Greet with your name + business.
- Ask what service they need and their preferred date/time.
- If theyâ€™re unsure, offer to check today/tomorrow during local hours (${v.hours || "09:00â€“18:00"}).

2) Check Availability
- When a time is provided or options requested, call **check_availability** with ISO 8601 in ${v.timezone}.
- If available â†’ proceed to booking.
- If unavailable â†’ offer 2â€“3 closest alternatives within ${v.hours || "business hours"}.

3) Book Appointment
- Collect full name, phone, and email.
- Confirm service type and final time (ISO 8601).
- Call **book_appointment** with: name, email, phone_number, service_type, time.
- Tell them a confirmation email will be sent from ${v.email || "the business"}.
${upsellLine}

## Policies:
${policies}

## Output Style:
â€¢ Short messages; avoid walls of text.
â€¢ Booking ask: â€œI can lock in [DATE, TIME]. Whatâ€™s your full name, email, and phone?â€
â€¢ After booking: â€œYouâ€™re all set! A confirmation was sent to [email].â€

## Fail-safes:
â€¢ If unsure about price/policy/availability, say youâ€™ll confirm before scheduling.
â€¢ Never provide medical/legal/financial advice; escalate if asked.
â€¢ Keep times in ${v.timezone} and in the future.`;
    }

    function truncatePreview(text, max=900) {
      return text.length > max ? text.slice(0, max) + "\n\nâ€¦(preview truncated)" : text;
    }

    // ********* CORRECT n8n JSON BUILDERS (imports clean, correct nodes/types) *********

    // Workflow 1: check_availability
    function buildN8NCheckWorkflow(v) {
      const calId = v.calendarId || "primary";
      const tz = v.timezone || "America/New_York";
      const hours = v.hours || "09:00-18:00";

      return {
        "name": "Check Availability",
        "nodes": [
          {
            "parameters": {
              "path": "check-availability",
              "options": {
                "responseMode": "lastNode",
                "responseCode": 200
              }
            },
            "id": "Webhook_Check",
            "name": "Webhook (check_availability)",
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 1,
            "position": [260, 300]
          },
          {
            "parameters": {
              "language": "JavaScript",
              "jsCode": "// Expect JSON: { time: ISO8601, durationMin?: number, hours?: \"09:00-18:00\", tz?: string }\\n// Fallback: now+1h, 60m.\\nconst b = items[0].json || {};\\nconst startISO = b.time || new Date(Date.now() + 60*60*1000).toISOString();\\nconst durationMin = Number(b.durationMin || 60);\\nconst endISO = new Date(new Date(startISO).getTime() + durationMin * 60000).toISOString();\\nreturn [{ json: { start: startISO, end: endISO, durationMin, hours: b.hours || \"" + hours + "\", tz: b.tz || \"" + tz + "\" } }];"
            },
            "id": "Code_Parse",
            "name": "Parse Requested Time",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [520, 300]
          },
          {
            "parameters": {
              "operation": "availability",
              "calendar": { "mode": "id", "value": calId },
              "timeMin": "={{$json.start}}",
              "timeMax": "={{$json.end}}",
              "timeZone": "={{$json.tz}}"
            },
            "id": "GCal_FreeBusy",
            "name": "Google Calendar: Availability",
            "type": "n8n-nodes-base.googleCalendar",
            "typeVersion": 3,
            "position": [780, 300],
            "credentials": {
              "googleCalendarOAuth2Api": {
                "id": "__CONNECT_IN_N8N__",
                "name": "Google OAuth"
              }
            }
          },
          {
            "parameters": {
              "conditions": {
                "boolean": [
                  { "value1": "={{$json.busy && $json.busy.length === 0}}", "operation": "isTrue" }
                ]
              }
            },
            "id": "IF_Free",
            "name": "IF Slot Free?",
            "type": "n8n-nodes-base.if",
            "typeVersion": 1,
            "position": [1040, 300]
          },
          {
            "parameters": {
              "responseBody": "={{ { result: \"available\", start: $json.start, end: $json.end, tz: $json.tz } }}"
            },
            "id": "Respond_Available",
            "name": "Respond: Available",
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1,
            "position": [1300, 220]
          },
          {
            "parameters": {
              "language": "JavaScript",
              "jsCode": "// Build 3 alternative ISO slots near requested time within business hours.\\nconst inItem = items[0].json;\\nconst start = new Date(inItem.start);\\nconst duration = Number(inItem.durationMin || 60);\\nconst hours = inItem.hours || \"" + hours + "\";\\nconst [oH,oM] = hours.split(\"-\")[0].split(\":\").map(Number);\\nconst [cH,cM] = hours.split(\"-\")[1].split(\":\").map(Number);\\nfunction withinHours(d){ const mins = d.getHours()*60 + d.getMinutes(); return mins >= (oH*60+oM) && (mins + duration) <= (cH*60+cM); }\\nconst alts=[]; let step=30, tries=0;\\nwhile(alts.length<3 && tries<48){ tries++; const t=new Date(start.getTime()+step*60000); step+=30; if(withinHours(t)) alts.push(t.toISOString()); }\\nreturn [{ json: { result: \"unavailable\", message: \"Here are alternative times:\", alternatives: alts, requested: inItem.start, tz: inItem.tz } }];"
            },
            "id": "Code_Alternatives",
            "name": "Build Alternative Times",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [1300, 380]
          },
          {
            "parameters": { "responseBody": "={{$json}}" },
            "id": "Respond_Alternatives",
            "name": "Respond: Alternatives",
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1,
            "position": [1540, 380]
          }
        ],
        "connections": {
          "Webhook (check_availability)": { "main": [[ { "node": "Parse Requested Time", "type": "main", "index": 0 } ]] },
          "Parse Requested Time": { "main": [[ { "node": "Google Calendar: Availability", "type": "main", "index": 0 } ]] },
          "Google Calendar: Availability": { "main": [[ { "node": "IF Slot Free?", "type": "main", "index": 0 } ]] },
          "IF Slot Free?": {
            "main": [
              [ { "node": "Respond: Available", "type": "main", "index": 0 } ],
              [ { "node": "Build Alternative Times", "type": "main", "index": 0 } ]
            ]
          },
          "Build Alternative Times": { "main": [[ { "node": "Respond: Alternatives", "type": "main", "index": 0 } ]] }
        },
        "active": false,
        "settings": { "timezone": tz },
        "pinData": {}
      };
    }

    // Workflow 2: book_appointment
    function buildN8NBookWorkflow(v) {
      const calId = v.calendarId || "primary";
      const tz = v.timezone || "America/New_York";

      return {
        "name": "Book Appointment",
        "nodes": [
          {
            "parameters": {
              "path": "book-appointment",
              "options": { "responseMode": "lastNode", "responseCode": 200 }
            },
            "id": "Webhook_Book",
            "name": "Webhook (book_appointment)",
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 1,
            "position": [260, 300]
          },
          {
            "parameters": {
              "language": "JavaScript",
              "jsCode": "// Expect JSON: { full_name, email, phone_number, service_type, time, tz }\\nconst b = items[0].json || {};\\nconst start = b.time ? new Date(b.time) : new Date(Date.now() + 2*3600*1000);\\nconst end = new Date(start.getTime() + 60*60000);\\nreturn [{ json: {\\n  full_name: b.full_name || \"Unknown\",\\n  email: b.email || \"\",\\n  phone_number: b.phone_number || \"\",\\n  service_type: b.service_type || \"General\",\\n  start: start.toISOString(),\\n  end: end.toISOString(),\\n  tz: b.tz || \"" + tz + "\"\\n}}];"
            },
            "id": "Code_Normalize",
            "name": "Normalize Inputs",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [520, 300]
          },
          {
            "parameters": {
              "operation": "create",
              "calendar": { "mode": "id", "value": calId },
              "start": "={{$json.start}}",
              "end": "={{$json.end}}",
              "summary": "={{\"Appointment â€” \" + $json.full_name}}",
              "description": "={{\"Service: \" + $json.service_type + \"\\nEmail: \" + $json.email + \"\\nPhone: \" + $json.phone_number}}",
              "sendUpdates": "all"
            },
            "id": "GCal_Create",
            "name": "Google Calendar: Create Event",
            "type": "n8n-nodes-base.googleCalendar",
            "typeVersion": 3,
            "position": [780, 300],
            "credentials": {
              "googleCalendarOAuth2Api": {
                "id": "__CONNECT_IN_N8N__",
                "name": "Google OAuth"
              }
            }
          },
          {
            "parameters": {
              "responseBody": "={{ { result: \"booked\", start: $json.start, end: $json.end, attendee: $json.full_name } }}"
            },
            "id": "Respond_Booked",
            "name": "Respond: Booked",
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1,
            "position": [1040, 300]
          }
        ],
        "connections": {
          "Webhook (book_appointment)": { "main": [[ { "node": "Normalize Inputs", "type": "main", "index": 0 } ]] },
          "Normalize Inputs": { "main": [[ { "node": "Google Calendar: Create Event", "type": "main", "index": 0 } ]] },
          "Google Calendar: Create Event": { "main": [[ { "node": "Respond: Booked", "type": "main", "index": 0 } ]] }
        },
        "active": false,
        "settings": { "timezone": tz },
        "pinData": {}
      };
    }

    // ------- PREVIEW + DOWNLOADS -------
    document.getElementById('previewBtn').addEventListener('click', () => {
      const v = getValues();
      const prompt = buildPrompt(v);
      document.getElementById('promptOut').textContent = truncatePreview(prompt);

      // enable downloads
      downloadPromptBtn.disabled = false;
      downloadAvailBtn.disabled = false;
      downloadBookBtn.disabled = false;

      // wire downloads with CORRECT JSON
      downloadPromptBtn.onclick = () => {
        const blob = new Blob([prompt], {type:"text/plain;charset=utf-8"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url;
        a.download = `${(v.bizName||"AI_Receptionist").replace(/\s+/g,'_')}_prompt.txt`; a.click();
        URL.revokeObjectURL(url);
      };

      const availJSON = buildN8NCheckWorkflow(v);
      const bookJSON  = buildN8NBookWorkflow(v);

      downloadAvailBtn.onclick = () => {
        const url = URL.createObjectURL(new Blob([JSON.stringify(availJSON, null, 2)], {type:"application/json"}));
        const a = document.createElement('a'); a.href = url; a.download = "check_availability.n8n.json"; a.click();
        URL.revokeObjectURL(url);
      };
      downloadBookBtn.onclick = () => {
        const url = URL.createObjectURL(new Blob([JSON.stringify(bookJSON, null, 2)], {type:"application/json"}));
        const a = document.createElement('a'); a.href = url; a.download = "book_appointment.n8n.json"; a.click();
        URL.revokeObjectURL(url);
      };

      notice.textContent = "Downloads ready. Import JSONs into n8n, connect Google OAuth, and set CALENDAR_ID or leave primary.";
    });

    // ------- ElevenLabs TTS preview (via /api/tts) -------
    async function elevenLabsPreview() {
      const v = getValues();
      const voiceId   = '21m00Tcm4TlvDq8ikWAM';
      const modelId   = 'eleven_multilingual_v2';
      const stability = 0.5;
      const text = `Hey, this is ${v.agentName || "Alex"} with ${v.bizName || "your business"}, how can I help you today?`;

      const res = await fetch('/api/tts', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ text, voice_id: voiceId, model_id: modelId, voice_settings: { stability, similarity_boost: 0.7 } })
      });

      if (!res.ok) {
        const errTxt = await res.text().catch(()=>res.statusText);
        alert('TTS error: ' + errTxt);
        return;
      }

      const blob = await res.blob();
      const url = URL.createObjectURL(blob);
      audioEl.src = url;
      audioWrap.classList.remove('hidden');
      audioEl.play().catch(()=>{});
      audioDownload.href = url;
    }
    ttsBtn.addEventListener('click', elevenLabsPreview);
  </script>
</body>
</html>
