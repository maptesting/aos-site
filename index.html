<!doctype html>
<html lang="en" class="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AOS — AI Receptionist Builder</title>

  <!-- SEO -->
  <meta name="description" content="Build a production-ready AI Receptionist in minutes — full prompt + n8n workflows + voice preview.">
  <meta property="og:title" content="AOS — AI Receptionist Builder">
  <meta property="og:description" content="Generate a custom AI receptionist instantly — prompt, workflows, and voice demo included.">
  <meta property="og:image" content="https://yourdomain.com/og-preview.png">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            ink: '#0a0f1c',
            panel: 'rgba(255,255,255,.04)',
            line: 'rgba(255,255,255,.08)',
            brand: {
              50:'#eaf1ff',100:'#d7e5ff',200:'#b4ceff',300:'#86aeff',400:'#5a8aff',500:'#2e66ff',
              600:'#204de0',700:'#1a3db7',800:'#15348f',900:'#112a74'
            },
            violetx: { 500:'#7c4dff' }
          },
          boxShadow: {
            soft: '0 8px 28px rgba(0,0,0,.22)',
            ring: '0 0 0 1px rgba(255,255,255,.06), 0 12px 60px rgba(90,138,255,.25)'
          },
          backdropBlur: { xs: '2px' }
        }
      }
    }
  </script>

  <!-- Global Styles (revamped aesthetic) -->
  <style>
    :root { color-scheme: dark }
    body {
      background:
        radial-gradient(900px 600px at 85% -10%, rgba(90,138,255,.18), transparent 60%),
        radial-gradient(700px 500px at -10% 30%, rgba(124,77,255,.15), transparent 60%),
        #0a0f1c;
      color: #fff;
      font-feature-settings: "ss01" on, "cv05" on;
    }
    /* Subtle grid layer */
    .bg-grid {
      position: absolute; inset: 0; pointer-events: none; mask-image: radial-gradient(70% 60% at 50% 20%, #000 60%, transparent 100%);
    }
    .bg-grid:before {
      content: ""; position: absolute; inset: 0;
      background-image:
        linear-gradient(to right, rgba(255,255,255,.05) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255,255,255,.05) 1px, transparent 1px);
      background-size: 40px 40px;
      opacity: .25;
    }
    .glass { background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03)); border: 1px solid rgba(255,255,255,.08); backdrop-filter: blur(10px) }
    .btn { border-radius: 14px; padding: .8rem 1.05rem; font-weight: 600 }
    .btn-primary { background: linear-gradient(90deg, #2e66ff, #7c4dff); box-shadow: var(--btn-shadow, 0 10px 40px rgba(94,129,255,.35)); }
    .btn-primary:hover { filter: brightness(1.05) saturate(1.02) }
    .btn-ghost { border: 1px solid rgba(255,255,255,.12); background: transparent }
    .code { white-space: pre-wrap; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace }
    input, textarea, select {
      background: rgba(255,255,255,.04); border: 1px solid rgba(255,255,255,.12); border-radius: 12px; padding: .85rem 1rem
    }
    input::placeholder, textarea::placeholder { color: rgba(255,255,255,.45) }
    input:focus, textarea:focus, select:focus { outline: none; box-shadow: 0 0 0 2px rgba(94,129,255,.45) }

    /* Audio range */
    .range { appearance:none; height: 6px; border-radius: 999px; background: linear-gradient(to right, #5a8aff var(--pct,0%), rgba(255,255,255,.22) 0) }
    .range::-webkit-slider-thumb{ appearance:none; width:14px; height:14px; border-radius:999px; background:#fff; border:2px solid #2e66ff; box-shadow:0 0 0 3px rgba(90,138,255,.25) }

    /* Section spacing */
    .section { padding-block: clamp(56px, 10vw, 108px) }
    .muted { color: rgba(255,255,255,.66) }
  </style>

  <!-- Optional analytics -->
  <!-- <script defer data-domain="yourdomain.com" src="https://plausible.io/js/script.js"></script> -->
</head>
<body>
  <!-- ===== NAV ===== -->
  <header class="border-b border-white/10 sticky top-0 z-40 backdrop-blur bg-black/30">
    <div class="max-w-7xl mx-auto px-5 h-16 flex items-center justify-between">
      <a href="#/" class="flex items-center gap-3">
        <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-brand-500 to-violetx-500 grid place-items-center text-black font-bold">A</div>
        <div class="leading-tight">
          <div class="font-semibold tracking-wide">AOS</div>
          <div class="text-[11px] text-white/60 -mt-0.5">AI Optimization Solutions</div>
        </div>
      </a>
      <nav class="flex items-center gap-1">
        <a href="#features" class="px-3 py-2 rounded-lg hover:bg-white/10">Features</a>
        <a href="#builder" class="px-3 py-2 rounded-lg hover:bg-white/10">Builder</a>
        <a href="#agents" class="px-3 py-2 rounded-lg hover:bg-white/10">Agents</a>
        <a href="#video" class="px-3 py-2 rounded-lg hover:bg-white/10">Tutorial</a>
        <a href="#builder" class="btn btn-primary ml-2">Build Free</a>
      </nav>
    </div>
  </header>

  <!-- ===== HERO (revamp) ===== -->
  <section class="relative section overflow-hidden">
    <div class="bg-grid"></div>
    <div class="max-w-7xl mx-auto px-5 grid lg:grid-cols-2 gap-14 items-center">
      <div>
        <h1 class="text-4xl md:text-6xl font-extrabold leading-[1.05]">
          Launch an <span class="bg-gradient-to-r from-brand-400 to-violetx-500 bg-clip-text text-transparent">AI Receptionist</span> in minutes.
        </h1>
        <p class="muted text-lg mt-6 max-w-2xl">
          Production-grade system prompt, two n8n workflows for availability & booking, and a clean voice preview—generated from your business details.
        </p>

        <div class="mt-8 flex gap-3">
          <a href="#builder" class="btn btn-primary">Start Building</a>
          <a href="#features" class="btn btn-ghost">See how it works</a>
        </div>

        <div class="mt-10 grid grid-cols-3 max-w-md gap-6 text-white/60 text-xs">
          <div class="glass rounded-xl px-3 py-2 border border-white/10">Google Calendar</div>
          <div class="glass rounded-xl px-3 py-2 border border-white/10">n8n Templates</div>
          <div class="glass rounded-xl px-3 py-2 border border-white/10">Voice Preview</div>
        </div>
      </div>

      <!-- Right: product mock card -->
      <div class="glass rounded-2xl p-6 md:p-8 shadow-ring">
        <div class="text-sm text-white/60 mb-2">Receptionist demo</div>
        <div id="chatBox" class="h-72 overflow-y-auto bg-black/30 rounded-xl p-3 space-y-3 text-sm border border-white/10">
          <div class="flex gap-3">
            <div class="w-8 h-8 rounded-full bg-gradient-to-br from-brand-500 to-violetx-500 grid place-items-center text-black font-bold">A</div>
            <div>Hi — I can answer questions and book your appointment. How can I help?</div>
          </div>
        </div>
        <form id="chatForm" class="mt-3 flex gap-2" action="javascript:void(0)" autocomplete="off">
          <input id="chatInput" type="text" placeholder="Type your message…" class="flex-1 bg-white/5 border border-white/10 rounded-xl px-3 py-2 text-sm" required>
          <button id="chatSend" type="submit" class="btn btn-primary">Send</button>
        </form>
      </div>
    </div>
  </section>

  <!-- ===== FEATURE BAND ===== -->
  <section id="features" class="section border-y border-white/10">
    <div class="max-w-7xl mx-auto px-5">
      <div class="grid md:grid-cols-3 gap-6">
        <div class="glass rounded-2xl p-6 border border-white/10">
          <h3 class="font-semibold text-lg">Prompt + Workflows</h3>
          <p class="muted mt-2">We generate a full, production prompt and two n8n JSONs: <em>checkAvailability</em> and <em>bookAppointment</em>.</p>
        </div>
        <div class="glass rounded-2xl p-6 border border-white/10">
          <h3 class="font-semibold text-lg">Drop-in Ready</h3>
          <p class="muted mt-2">Injects your timezone, calendar ID, and unique webhook paths—no manual JSON tinkering.</p>
        </div>
        <div class="glass rounded-2xl p-6 border border-white/10">
          <h3 class="font-semibold text-lg">Clean Voice Preview</h3>
          <p class="muted mt-2">Try voices instantly via 11Labs with a custom player and graceful rate-limit handling.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== BUILDER ===== -->
  <section id="builder" class="section">
    <div class="max-w-7xl mx-auto px-5">
      <div class="grid lg:grid-cols-2 gap-10 items-start">
        <!-- Form -->
        <div class="glass rounded-2xl p-6 md:p-8 border border-white/10">
          <h2 class="text-2xl font-bold">Your business</h2>
          <p class="muted text-sm mt-1">We’ll use this to shape the prompt and patch the workflows.</p>

          <form id="aiForm" class="grid gap-4 mt-6">
            <input name="bizName" placeholder="Business Name" required>
            <input name="location" placeholder="Location / Service area" required>
            <input name="industry" placeholder="Industry (e.g., salon, rentals, clinic)" required>
            <input name="services" placeholder="Services (comma-separated)" required>

            <div class="grid md:grid-cols-2 gap-4">
              <input name="agentName" placeholder="Agent Name" value="Alex">
              <input name="language" placeholder="Language" value="English">
            </div>

            <div class="grid md:grid-cols-2 gap-4">
              <input name="hours" placeholder="Hours (e.g., Mon–Sat 9–6)">
              <input name="timezone" placeholder="Timezone (e.g., America/New_York)">
            </div>

            <div class="grid md:grid-cols-2 gap-4">
              <input name="calendarId" placeholder="Google Calendar ID (e.g., primary)">
              <input name="email" type="email" placeholder="Confirmation email sender (optional)">
            </div>

            <textarea name="policies" rows="2" placeholder="Policies / deposits / refunds (optional)"></textarea>

            <div class="grid md:grid-cols-2 gap-4 items-end pt-2">
              <div>
                <label class="block text-sm text-white/70 mb-1" for="voiceSelect">Voice</label>
                <select id="voiceSelect"><option>Loading voices…</option></select>
              </div>
              <div class="flex flex-wrap gap-3">
                <button type="button" id="previewBtn" class="btn btn-primary inline-flex items-center gap-2">
                  <span id="previewSpinner" class="hidden inline-block w-4 h-4 border-2 border-white/40 border-t-white rounded-full animate-spin"></span>
                  <span>Prepare downloads</span>
                </button>
                <button type="button" id="ttsBtn" class="btn btn-ghost">Hear greeting</button>
              </div>
            </div>
          </form>
        </div>

        <!-- Output -->
        <div class="space-y-6">
          <div class="glass rounded-2xl p-6 md:p-8 border border-white/10">
            <h3 class="text-lg font-semibold">System Prompt (preview)</h3>
            <p class="text-xs text-white/60">Preview is truncated; the download is the full prompt.</p>
            <div id="promptOut" class="code text-sm bg-black/25 rounded-xl p-4 border border-white/10 min-h-[260px] mt-3"></div>

            <div class="mt-6">
              <h4 class="text-sm font-semibold text-white/80 mb-2">Downloads</h4>
              <div class="flex flex-wrap gap-2">
                <button id="downloadPromptBtn" class="btn btn-primary disabled:opacity-50" disabled>Full Prompt (.txt)</button>
                <button id="downloadAvailBtn" class="btn btn-ghost disabled:opacity-50" disabled>checkAvailability.json</button>
                <button id="downloadBookBtn"  class="btn btn-ghost disabled:opacity-50" disabled>bookAppointment.json</button>
              </div>
              <div id="successMsg" class="hidden mt-3 text-sm text-green-400">Downloaded</div>
            </div>
          </div>

          <div class="glass rounded-2xl p-6 md:p-8 border border-white/10">
            <h3 class="text-lg font-semibold">Voice preview</h3>
            <audio id="audio" class="hidden"></audio>
            <div id="audioUI" class="hidden mt-3 glass rounded-xl p-4">
              <div class="flex items-center gap-3">
                <button id="audioPlay" class="w-10 h-10 rounded-full bg-gradient-to-br from-brand-500 to-violetx-500 grid place-items-center text-black font-bold">►</button>
                <div class="flex-1">
                  <input id="audioSeek" type="range" min="0" max="100" value="0" class="w-full range">
                  <div class="flex justify-between text-xs text-white/60 mt-1">
                    <span id="audioTime">0:00</span><span id="audioDur">0:00</span>
                  </div>
                </div>
                <a id="audioDownload" download="ai-greeting.mp3" class="text-sm underline decoration-blue-400">Download</a>
              </div>
              <div id="notice" class="mt-2 text-xs text-white/60"></div>
              <div id="debug" class="mt-2 text-xs text-red-400"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tutorial -->
      <div id="video" class="mt-12 glass rounded-2xl p-6 md:p-8 border border-white/10">
        <h3 class="font-semibold">Quick tutorial</h3>
        <p class="text-white/60 text-sm mt-1">3-minute walk-through on using this builder.</p>
        <div class="mt-4 rounded-xl overflow-hidden border border-white/10 aspect-video">
          <iframe class="w-full h-full"
            src="https://www.youtube.com/embed/Akwe5h3CQKo?si=Q-Uto-rIMjTar1vv"
            title="How to use the AOS site" frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== AGENTS ===== -->
  <section id="agents" class="section border-t border-white/10">
    <div class="max-w-7xl mx-auto px-5">
      <div class="max-w-3xl">
        <h2 class="text-3xl font-bold">More plug-and-play agents</h2>
        <p class="muted mt-2">Each opens its own page to generate a tailored full prompt + n8n JSON.</p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-5 mt-8">
        <a href="#/agent/invoice" class="glass rounded-2xl p-5 border border-white/10 hover:shadow-ring transition-all">
          <div class="text-lg font-semibold">AI Invoice / Follow-ups</div>
          <div class="text-sm text-white/70 mt-1">Generate invoices + gentle reminders; log to Airtable.</div>
        </a>
        <a href="#/agent/salesCloser" class="glass rounded-2xl p-5 border border-white/10 hover:shadow-ring transition-all">
          <div class="text-lg font-semibold">AI Sales Closer</div>
          <div class="text-sm text-white/70 mt-1">Objection-aware nudges via SMS/Email. Auto-logs follow-ups.</div>
        </a>
        <a href="#/agent/leadQualifier" class="glass rounded-2xl p-5 border border-white/10 hover:shadow-ring transition-all">
          <div class="text-lg font-semibold">AI Lead Qualifier</div>
          <div class="text-sm text-white/70 mt-1">Score & route leads (A/B/C). Email both lead & owner.</div>
        </a>
        <a href="#/agent/dmResponder" class="glass rounded-2xl p-5 border border-white/10 hover:shadow-ring transition-all">
          <div class="text-lg font-semibold">AI DM Responder</div>
          <div class="text-sm text-white/70 mt-1">Short replies for IG/TikTok that push to your CTA.</div>
        </a>
      </div>
    </div>
  </section>

  <!-- ===== AGENT DETAIL (SPA) ===== -->
  <main id="view-agent" class="hidden">
    <section class="section">
      <div class="max-w-5xl mx-auto px-5">
        <a href="#/" class="inline-flex items-center gap-2 text-white/80 hover:text-white mb-6">← Back</a>
        <div class="glass rounded-2xl p-6 md:p-8 border border-white/10">
          <h2 id="agentTitle" class="text-2xl font-bold"></h2>
          <p id="agentDesc" class="text-white/70 mt-2"></p>

          <form id="agentForm" class="grid gap-4 mt-6"></form>

          <div class="mt-6">
            <div class="flex flex-wrap gap-2">
              <button id="agentGenerate" class="btn btn-primary">Generate</button>
              <a id="agentPromptDownload" class="btn btn-ghost">Full Prompt (.txt)</a>
              <a id="agentJsonDownload" class="btn btn-ghost">n8n JSON</a>
            </div>
            <div id="agentMsg" class="text-xs text-green-400 mt-3 hidden">Generated ✓</div>

            <h4 class="mt-6 font-semibold">Prompt Preview</h4>
            <div id="agentPromptPreview" class="code text-sm bg-black/25 rounded-xl p-4 border border-white/10 min-h-[180px] mt-2"></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- ===== FOOTER ===== -->
  <footer class="py-10 text-center text-white/45 text-sm border-t border-white/10">
    © <span id="year"></span> AOS — AI Optimization Solutions
  </footer>
  <script>document.getElementById('year').textContent = new Date().getFullYear();</script>

  <!-- ===== EMBEDDED RECEPTIONIST n8n TEMPLATES (EXACT) ===== -->
  <script id="tplCheckAvailability" type="application/json">
{
  "name": "checkAvailability",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "0635b597-12bc-4601-87d9-530c58e028ff",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [-640,432],
      "id": "09e7f082-cfac-4027-80a6-9edeb64ef87d",
      "name": "Webhook",
      "webhookId": "0635b597-12bc-4601-87d9-530c58e028ff"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Role: \n\nYou are an appointment availability checker. Your job is to get the requested time and use the calendar to check availability for the customer.\n\nThe current date and time is: {{ $now }}\n\nCustomer requested time is:\n{{ $json.body.message.toolCallList[0].function.arguments.time }}\n\nCalendar data:\nWorking hours 8am - 9pm\nLength of each slot: 1 hour\n\nBooking Process\n\n-Check if the customer’s requested time is available using the calendar\n-If the time is available let the AI model know & confirm\n-If the time is unavailable, suggest up to 2 alternative slots close to the requested time, by checking the availability again\n-If there are no slots upon rechecking within that day, search the next weekday from the current time and provide alternative slots. \n\nResponse & output:\n\n-If the requested time is available confirm it by saying:\nE.g: The requested time of 10am on June 22nd is available, just to confirm would you like to book this?\n-If you have found no availability or unavailable in the requested time, suggest up to 3 alternative slots closest to the requested time.\n-If no slots exist within the day suggest 3 more times the next weekday.\n-Your output must be natural and conversational e.g. “Hey there, the time that you requested of 10am on June 22nd is available, just to confirm would you like to book this?”\n\nImportant notes:\n\n- You must not output your result in the past, aways check availability in the future, use the current time you have received and the requested data to help make that decision.\n-Your ability to follow these steps precisely is very crucial and can impact the business’s reputation.",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [-336,368],
      "id": "75f18a8b-f48d-4027-8872-98ce8cbd7ecd",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [-416,608],
      "id": "bde217d0-c5bb-412f-9b56-b50967ddcbee",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "exm7lxhShqpiglPn",
          "name": "n8n free OpenAI API credits"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\n  \"results\": [\n    {\n      \"toolCallId\": \"{{ $('Webhook').item.json.body.message.toolCalls[0].id }}\",\n      \"result\": \"{{ $json.output }}\"\n    }\n  ]\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [64,416],
      "id": "ffe1fcc9-82a3-4284-9069-897621ab7d13",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "resource": "calendar",
        "calendar": {
          "__rl": true,
          "value": "razerrtrading@gmail.com",
          "mode": "list",
          "cachedResultName": "razerrtrading@gmail.com"
        },
        "timeMin": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start_Time', ``, 'string') }}",
        "timeMax": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End_Time', ``, 'string') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [-144,624],
      "id": "fe54952b-15ca-4f28-a9b3-476ca9858ae4",
      "name": "check availability",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "VyBLeoRYD28XxnYS",
          "name": "Google Calendar account"
        }
      }
    }
  ],
  "pinData": { "Webhook": [ { "json": { "headers": {}, "params": {}, "query": {}, "body": {} }, "webhookUrl": "", "executionMode": "test" } ] },
  "connections": {
    "Webhook": { "main": [ [ { "node": "AI Agent", "type": "main", "index": 0 } ] ] },
    "OpenAI Chat Model": { "ai_languageModel": [ [ { "node": "AI Agent", "type": "ai_languageModel", "index": 0 } ] ] },
    "AI Agent": { "main": [ [ { "node": "Respond to Webhook", "type": "main", "index": 0 } ] ] },
    "check availability": { "ai_tool": [ [ { "node": "AI Agent", "type": "ai_tool", "index": 0 } ] ] }
  },
  "active": false,
  "settings": { "executionOrder": "v1" },
  "versionId": "6244fb20-f4d2-4e76-bc7b-bfbcc2e69ffb",
  "meta": { "templateCredsSetupCompleted": true, "instanceId": "7f9d..." },
  "id": "s2Oz4PD8hi3d8dXJ",
  "tags": []
}
  </script>

  <script id="tplBookAppointment" type="application/json">
{
  "name": "bookAppointment",
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are a appointment booking AI Agent your job is to use the \"Create an event in Google Calendar\" tool to get the details of the customer and create a event/ booking in the calendar. \n\nThe confirmed time:  {{ $json.body.message.toolCalls[0].function.arguments.time }}\n\nTime now (use for bookings) : {{ $now }}\n\nAppointment duration will be one hour. Simply add one hour on to the confirm time, use the confirm time as the start time and then simply just add one hour on to the confirm time to get the end time. \n\nIf the event has been schedualed please provide your output in this format:\n\nOutput: \n\nHey there the appointment at July 18th 2025 for a message has been schedualed we will see you there. ",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [-832,144],
      "id": "b4d922ad-2b69-49d5-a2da-17c1ecbe345f",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [-912,384],
      "id": "c1c61458-8e97-4e7c-ab54-d395e74ae84a",
      "name": "OpenAI Chat Model"
    },
    {
      "parameters": {
        "calendar": {
          "__rl": true,
          "value": "razerrtrading@gmail.com",
          "mode": "list",
          "cachedResultName": "razerrtrading@gmail.com"
        },
        "start": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}",
        "end": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}",
        "additionalFields": {
          "attendees": [ "={{ $('Webhook1').item.json.body.message.toolCalls[0].function.arguments.email }}" ],
          "description": "=Details of the Appointment: \nname:{{ $json.body.message.toolCallList[0].function.arguments.full_name }} \nService Type: {{ $('Webhook1').item.json.body.message.toolCalls[0].function.arguments.service_type }}\nTime::{{ $json.body.message.toolCallList[0].function.arguments.time }} \nEmail:{{ $('Webhook1').item.json.body.message.toolCalls[0].function.arguments.email }}",
          "summary": "=New Appointment For  {{ $json.body.message.toolCallList[0].function.arguments.full_name }} at {{ $json.body.message.toolCallList[0].function.arguments.time }}"
        }
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [-672,384],
      "id": "7b5d02c2-e5e4-4609-ad6c-4ba402a9a757",
      "name": "Create an event in Google Calendar"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\n  \"results\": [\n    {\n      \"toolCallId\": \"{{ $('Webhook1').item.json.body.message.toolCalls[0].id }}\",\n      \"result\": \"{{ $json.output }}\"\n    }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [-368,224],
      "id": "57b1eac0-b482-4a59-9228-a6cc5cd30025",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "test77823457892345879245",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [-1104,208],
      "id": "a5013f1c-24ed-4d41-8d36-e9a579100421",
      "name": "Webhook1",
      "webhookId": "e909a8bc-5aba-477b-a3d5-3be663cd655d"
    }
  ],
  "pinData": { "Webhook1": [ { "json": { "headers": {}, "params": {}, "query": {}, "body": {} }, "webhookUrl": "", "executionMode": "test" } ] },
  "connections": {
    "OpenAI Chat Model": { "ai_languageModel": [ [ { "node": "AI Agent", "type": "ai_languageModel", "index": 0 } ] ] },
    "Create an event in Google Calendar": { "ai_tool": [ [ { "node": "AI Agent", "type": "ai_tool", "index": 0 } ] ] },
    "AI Agent": { "main": [ [ { "node": "Respond to Webhook", "type": "main", "index": 0 } ] ] },
    "Webhook1": { "main": [ [ { "node": "AI Agent", "type": "main", "index": 0 } ] ] }
  },
  "active": false,
  "settings": { "executionOrder": "v1" },
  "versionId": "1204e689-05e3-4059-82cc-e6e5cac9d410",
  "meta": { "instanceId": "7f9d..." },
  "id": "rk03nuO44WQh49bc",
  "tags": []
}
  </script>

  <!-- ===== AGENT PROMPTS (LONG) ===== -->
  <script id="prInvoice" type="text/plain">
You are {{AGENT_NAME}}, an invoice/follow-up assistant for {{BIZ_NAME}}.
Task: when provided a customer + line items, generate a clear, friendly invoice email with due date, payment link, and gentle follow-ups if overdue.

Must collect/accept:
- client name, email
- line items as [{desc, qty, unitPrice}] and compute totals
- taxes/fees per {{TAX_RULES_SNIPPET}} if provided
- terms, due date, payment link {{PAYMENT_LINK}}
- business contact {{BIZ_EMAIL}}

Tone: professional, 2–4 short sentences, no fluff.

OUTPUT JSON ONLY (no prose):
{ "intent":"invoice" | "reminder",
  "toEmail":"", "subject":"", "textBody":"",
  "total": number, "dueISO":"", "paymentLink":"{{PAYMENT_LINK}}"
}
If input suggests a reminder (overdue), set intent to "reminder" and adjust tone slightly firmer but polite.
  </script>

  <script id="prSalesCloser" type="text/plain">
You are {{AGENT_NAME}}, a sales closer for {{BIZ_NAME}}.
Goal: convert warm leads to a booked call or paid order.

Context inputs: lead name, last interaction, offer {{OFFER_SNIPPET}}, CTA {{CTA_URL}}.
Strategy:
- If no reply: send Nudge A, then Nudge B after {{FOLLOWUP_GAP_HOURS}} hours.
- If objection (price/timing/fit), answer briefly with one strong benefit and exactly one CTA link.
- If ready, ask for a call time (2 slots) or link directly to checkout.

OUTPUT JSON ONLY:
{ "to":"", "channel":"sms|email", "subject":"", "textBody":"", "nextFollowupHours": {{FOLLOWUP_GAP_HOURS}}, "stage":"A|B|Close" }
Keep copy short and human. No emojis.
  </script>

  <script id="prLeadQualifier" type="text/plain">
You are {{AGENT_NAME}}, a lead qualifier for {{BIZ_NAME}}.
Qualify leads and route them according to {{QUAL_RULES}}.

Collect or use:
name, email, phone, company, budget, timeline, service need, location.

OUTPUT JSON ONLY:
{ "score": 0-100, "tier":"A|B|C", "reason":"", "recommendedNext":"book_call|nurture|reject",
  "emailToLead": {"subject":"","textBody":""},
  "emailToOwner": {"subject":"","textBody":""}
}
Terse, friendly, zero fluff. Reasons should be one sentence.
  </script>

  <script id="prDMResponder" type="text/plain">
You are {{AGENT_NAME}}, a DM responder for {{BIZ_NAME}}.
Reply to IG/TikTok DMs with short, human messages that move users to {{PRIMARY_CTA}} (link: {{BOOK_URL}}).
If complex product questions arise, answer briefly and point to {{FAQ_URL}}.

OUTPUT JSON ONLY:
{"reply":"", "suggestedTag":"lead|customer|spam"}

One or two lines max. No emojis unless user uses them first.
  </script>

  <!-- ===== AGENT n8n JSON TEMPLATES (YOUR EXACT GRAPHS) ===== -->
  <script id="tplAgentInvoice" type="application/json">
{
  "name": "AI Invoice & Follow-ups",
  "nodes": [
    { "parameters": { "path": "invoice", "options": { "responseData": "={{$json}}" } }, "id": "1", "name": "Webhook (Create/Reminder)", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [240, 300] },
    { "parameters": { "functionCode": "const b=$json; return [{payload:b}];" }, "id": "2", "name": "Normalize", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [480, 300] },
    { "parameters": { "authentication": "none", "url": "https://api.openai.com/v1/chat/completions", "jsonParameters": true, "responseFormat": "json", "sendBody": true, "headerParametersJson": "{ \n  \"Authorization\": \"Bearer {{OPENAI_API_KEY}}\",\n  \"Content-Type\":\"application/json\"\n}", "bodyParametersJson": "={\n  \"model\":\"{{OPENAI_MODEL}}\",\n  \"temperature\":0.3,\n  \"messages\":[\n    {\"role\":\"system\",\"content\":\"YOU_ARE_INVOICE_ASSISTANT\"},\n    {\"role\":\"user\",\"content\": JSON.stringify($json.payload) }\n  ]\n}" }, "id": "3", "name": "OpenAI - Draft Invoice/Reminder", "type": "n8n-nodes-base.httpRequest", "typeVersion": 4, "position": [720, 300] },
    { "parameters": { "functionCode": "const c=$json.choices?.[0]?.message?.content?.trim()||\"\"; let p; try{p=JSON.parse(c);}catch(e){p={intent:\"invoice\",toEmail:\"\",subject:\"Invoice\",textBody:c,total:0};} return [p];" }, "id": "4", "name": "Parse JSON", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [960, 300] },
    { "parameters": { "fromEmail": "{{SMTP_FROM}}", "toEmail": "={{$json.toEmail}}", "subject": "={{$json.subject}}", "text": "={{$json.textBody}}" }, "id": "5", "name": "Send Email", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [1180, 200], "credentials": { "smtp": { "id": "{{SMTP_CRED_ID}}", "name": "SMTP" } } },
    { "parameters": { "operation": "create", "base": "{{AIRTABLE_BASE_ID}}", "table": "{{AIRTABLE_TABLE}}", "fieldsUi": { "field": [ { "fieldId": "Client", "fieldValue": "={{$json.toEmail}}" }, { "fieldId": "Subject", "fieldValue": "={{$json.subject}}" }, { "fieldId": "Total", "fieldValue": "={{$json.total}}"}, { "fieldId": "DueISO", "fieldValue": "={{$json.dueISO}}"}, { "fieldId": "PaymentLink", "fieldValue": "={{$json.paymentLink}}"} ] } }, "id": "6", "name": "Log to Airtable", "type": "n8n-nodes-base.airtable", "typeVersion": 2, "position": [1180, 400], "credentials": { "airtableApi": { "id": "{{AIRTABLE_CRED_ID}}", "name": "Airtable API" } } },
    { "parameters": { "responseBody": "={{$json}}", "responseCode": 200 }, "id": "7", "name": "Return", "type": "n8n-nodes-base.respondToWebhook", "typeVersion": 1, "position": [1400, 300] }
  ],
  "connections": {
    "Webhook (Create/Reminder)": { "main": [ [ { "node": "Normalize", "type": "main", "index": 0 } ] ] },
    "Normalize": { "main": [ [ { "node": "OpenAI - Draft Invoice/Reminder", "type": "main", "index": 0 } ] ] },
    "OpenAI - Draft Invoice/Reminder": { "main": [ [ { "node": "Parse JSON", "type": "main", "index": 0 } ] ] },
    "Parse JSON": { "main": [ [ { "node": "Send Email", "type": "main", "index": 0 } ], [ { "node": "Log to Airtable", "type": "main", "index": 0 } ], [ { "node": "Return", "type": "main", "index": 0 } ] ] },
    "Send Email": { "main": [ [ { "node": "Return", "type": "main", "index": 0 } ] ] },
    "Log to Airtable": { "main": [ [ { "node": "Return", "type": "main", "index": 0 } ] ] }
  },
  "active": false
}
  </script>

  <script id="tplAgentSalesCloser" type="application/json">
{
  "name": "AI Sales Closer",
  "nodes": [
    { "parameters": { "path": "closer", "options": { "responseData": "={{$json}}" } }, "id": "1", "name": "Webhook (New Lead/Reply)", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [240, 300] },
    { "parameters": { "functionCode": "return [{$json}];" }, "id": "2", "name": "Pass", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [480, 300] },
    { "parameters": { "url": "https://api.openai.com/v1/chat/completions", "jsonParameters": true, "sendBody": true, "responseFormat": "json", "headerParametersJson": "{ \"Authorization\":\"Bearer {{OPENAI_API_KEY}}\",\"Content-Type\":\"application/json\"}", "bodyParametersJson": "={\"model\":\"{{OPENAI_MODEL}}\",\"temperature\":0.4,\"messages\":[{\"role\":\"system\",\"content\":\"YOU_ARE_SALES_CLOSER\"},{\"role\":\"user\",\"content\": JSON.stringify($json)}]}" }, "id": "3", "name": "OpenAI - Draft Reply", "type": "n8n-nodes-base.httpRequest", "typeVersion": 4, "position": [720, 300] },
    { "parameters": { "functionCode": "const s=$json.choices?.[0]?.message?.content?.trim()||\"\"; let p; try{p=JSON.parse(s);}catch(e){p={to:\"\",channel:\"sms\",textBody:s,subject:\"\"}} return [p];" }, "id": "4", "name": "Parse JSON", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [960, 300] },
    { "parameters": { "conditions": { "string": [ { "value1": "={{$json.channel}}", "operation": "equal", "value2": "sms" } ] } }, "id": "5", "name": "IF SMS?", "type": "n8n-nodes-base.if", "typeVersion": 1, "position": [1180, 260] },
    { "parameters": { "from": "{{TWILIO_FROM}}", "to": "={{$json.to}}", "message": "={{$json.textBody}}" }, "id": "6", "name": "Twilio - Send SMS", "type": "n8n-nodes-base.twilio", "typeVersion": 1, "position": [1400, 140], "credentials": { "twilioApi": { "id": "{{TWILIO_CRED_ID}}", "name": "Twilio" } } },
    { "parameters": { "fromEmail": "{{SMTP_FROM}}", "toEmail": "={{$json.to}}", "subject": "={{$json.subject}}", "text": "={{$json.textBody}}" }, "id": "7", "name": "Email - Send", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [1400, 380], "credentials": { "smtp": { "id": "{{SMTP_CRED_ID}}", "name": "SMTP" } } },
    { "parameters": { "operation": "create", "base": "{{AIRTABLE_BASE_ID}}", "table": "{{AIRTABLE_TABLE}}", "fieldsUi": { "field": [ { "fieldId": "To", "fieldValue": "={{$json.to}}" }, { "fieldId": "Channel", "fieldValue": "={{$json.channel}}" }, { "fieldId": "Stage", "fieldValue": "={{$json.stage}}" }, { "fieldId": "NextFollowupHours", "fieldValue": "={{$json.nextFollowupHours}}" } ] } }, "id": "8", "name": "Log to Airtable", "type": "n8n-nodes-base.airtable", "typeVersion": 2, "position": [1620, 260], "credentials": { "airtableApi": { "id": "{{AIRTABLE_CRED_ID}}", "name": "Airtable API" } } },
    { "parameters": { "responseBody": "={{$json}}", "responseCode": 200 }, "id": "9", "name": "Return", "type": "n8n-nodes-base.respondToWebhook", "typeVersion": 1, "position": [1840, 260] }
  ],
  "connections": {
    "Webhook (New Lead/Reply)": { "main": [ [ { "node": "Pass", "type": "main", "index": 0 } ] ] },
    "Pass": { "main": [ [ { "node": "OpenAI - Draft Reply", "type": "main", "index": 0 } ] ] },
    "OpenAI - Draft Reply": { "main": [ [ { "node": "Parse JSON", "type": "main", "index": 0 } ] ] },
    "Parse JSON": {
      "main": [
        [ { "node": "IF SMS?", "type": "main", "index": 0 } ],
        [ { "node": "Email - Send", "type": "main", "index": 0 } ],
        [ { "node": "Log to Airtable", "type": "main", "index": 0 } ],
        [ { "node": "Return", "type": "main", "index": 0 } ]
      ]
    },
    "IF SMS?": {
      "main": [
        [ { "node": "Twilio - Send SMS", "type": "main", "index": 0 } ],
        [ { "node": "Email - Send", "type": "main", "index": 0 } ]
      ]
    },
    "Twilio - Send SMS": { "main": [ [ { "node": "Log to Airtable", "type": "main", "index": 0 } ] ] },
    "Email - Send": { "main": [ [ { "node": "Log to Airtable", "type": "main", "index": 0 } ] ] },
    "Log to Airtable": { "main": [ [ { "node": "Return", "type": "main", "index": 0 } ] ] }
  },
  "active": false
}
  </script>

  <script id="tplAgentLeadQualifier" type="application/json">
{
  "name": "AI Lead Qualifier",
  "nodes": [
    { "parameters": { "path": "lead", "options": { "responseData": "={{$json}}" } }, "id": "1", "name": "Webhook (Lead In)", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [240, 300] },
    { "parameters": { "functionCode": "return [{$json}];" }, "id": "2", "name": "Pass", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [480, 300] },
    { "parameters": { "url": "https://api.openai.com/v1/chat/completions", "jsonParameters": true, "sendBody": true, "responseFormat": "json", "headerParametersJson": "{ \"Authorization\":\"Bearer {{OPENAI_API_KEY}}\",\"Content-Type\":\"application/json\"}", "bodyParametersJson": "={\"model\":\"{{OPENAI_MODEL}}\",\"temperature\":0.2,\"messages\":[{\"role\":\"system\",\"content\":\"YOU_ARE_LEAD_QUALIFIER\"},{\"role\":\"user\",\"content\": JSON.stringify($json)}]}" }, "id": "3", "name": "OpenAI - Qualify", "type": "n8n-nodes-base.httpRequest", "typeVersion": 4, "position": [720, 300] },
    { "parameters": { "functionCode": "const t=$json.choices?.[0]?.message?.content?.trim()||\"\"; let p; try{p=JSON.parse(t);}catch(e){p={score:50,tier:\"B\",reason:t,recommendedNext:\"nurture\"}} return [p];" }, "id": "4", "name": "Parse JSON", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [960, 300] },
    { "parameters": { "conditions": { "string": [ { "value1": "={{$json.recommendedNext}}", "operation": "equal", "value2": "book_call" } ] } }, "id": "5", "name": "IF Book Call", "type": "n8n-nodes-base.if", "typeVersion": 1, "position": [1180, 240] },
    { "parameters": { "fromEmail": "{{SMTP_FROM}}", "toEmail": "={{$json.emailToLead?.to || $json.lead?.email || \"\"}}", "subject": "={{$json.emailToLead.subject}}", "text": "={{$json.emailToLead.textBody}}" }, "id": "6", "name": "Email Lead", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [1400, 140], "credentials": { "smtp": { "id": "{{SMTP_CRED_ID}}", "name": "SMTP" } } },
    { "parameters": { "fromEmail": "{{SMTP_FROM}}", "toEmail": "{{BIZ_EMAIL}}", "subject": "={{$json.emailToOwner.subject}}", "text": "={{$json.emailToOwner.textBody}}" }, "id": "7", "name": "Email Owner", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [1400, 300], "credentials": { "smtp": { "id": "{{SMTP_CRED_ID}}", "name": "SMTP" } } },
    { "parameters": { "operation": "create", "base": "{{AIRTABLE_BASE_ID}}", "table": "{{AIRTABLE_TABLE}}", "fieldsUi": { "field": [ { "fieldId": "Score", "fieldValue": "={{$json.score}}" }, { "fieldId": "Tier", "fieldValue": "={{$json.tier}}" }, { "fieldId": "Reason", "fieldValue": "={{$json.reason}}" }, { "fieldId": "Next", "fieldValue": "={{$json.recommendedNext}}" } ] } }, "id": "8", "name": "Log to Airtable", "type": "n8n-nodes-base.airtable", "typeVersion": 2, "position": [1620, 240], "credentials": { "airtableApi": { "id": "{{AIRTABLE_CRED_ID}}", "name": "Airtable API" } } },
    { "parameters": { "responseBody": "={{$json}}", "responseCode": 200 }, "id": "9", "name": "Return", "type": "n8n-nodes-base.respondToWebhook", "typeVersion": 1, "position": [1840, 240] }
  ],
  "connections": {
    "Webhook (Lead In)": { "main": [ [ { "node": "Pass", "type": "main", "index": 0 } ] ] },
    "Pass": { "main": [ [ { "node": "OpenAI - Qualify", "type": "main", "index": 0 } ] ] },
    "OpenAI - Qualify": { "main": [ [ { "node": "Parse JSON", "type": "main", "index": 0 } ] ] },
    "Parse JSON": { "main": [ [ { "node": "IF Book Call", "type": "main", "index": 0 } ], [ { "node": "Email Owner", "type": "main", "index": 0 } ], [ { "node": "Log to Airtable", "type": "main", "index": 0 } ], [ { "node": "Return", "type": "main", "index": 0 } ] ] },
    "IF Book Call": { "main": [ [ { "node": "Email Lead", "type": "main", "index": 0 } ] ] },
    "Email Lead": { "main": [ [ { "node": "Log to Airtable", "type": "main", "index": 0 } ] ] },
    "Email Owner": { "main": [ [ { "node": "Log to Airtable", "type": "main", "index": 0 } ] ] },
    "Log to Airtable": { "main": [ [ { "node": "Return", "type": "main", "index": 0 } ] ] }
  },
  "active": false
}
  </script>

  <script id="tplAgentDMResponder" type="application/json">
{
  "name": "AI DM Responder",
  "nodes": [
    { "parameters": { "path": "dm-responder", "options": { "responseData": "={{$json}}" } }, "id":"1","name":"Webhook (DM)","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[240,300]},
    { "parameters": { "functionCode": "return [{$json}];" }, "id":"2","name":"Pass","type":"n8n-nodes-base.function","typeVersion":2,"position":[480,300]},
    { "parameters": { "url": "https://api.openai.com/v1/chat/completions","jsonParameters": true,"sendBody": true,"responseFormat":"json","headerParametersJson":"{\"Authorization\":\"Bearer {{OPENAI_API_KEY}}\",\"Content-Type\":\"application/json\"}","bodyParametersJson":"={\"model\":\"{{OPENAI_MODEL}}\",\"temperature\":0.5,\"messages\":[{\"role\":\"system\",\"content\":\"YOU_ARE_DM_RESPONDER\"},{\"role\":\"user\",\"content\": JSON.stringify($json)}]}" }, "id":"3","name":"OpenAI - DM Reply","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[720,300]},
    { "parameters": { "functionCode": "const s=$json.choices?.[0]?.message?.content?.trim()||\"\"; let p; try{p=JSON.parse(s);}catch(e){p={reply:s,suggestedTag:\"lead\"}} return [p];" }, "id":"4","name":"Parse JSON","type":"n8n-nodes-base.function","typeVersion":2,"position":[960,300]},
    { "parameters": { "url": "{{PLATFORM_REPLY_WEBHOOK}}", "jsonParameters": true, "options": {}, "sendBody": true, "bodyParametersJson": "={\"conversationId\": $json.conversationId || \"\", \"reply\": $json.reply }" }, "id":"5","name":"HTTP - Send Reply to Platform","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[1180,220]},
    { "parameters": { "operation": "create", "base": "{{AIRTABLE_BASE_ID}}", "table": "{{AIRTABLE_TABLE}}", "fieldsUi": { "field": [ { "fieldId": "ConversationId", "fieldValue": "={{$json.conversationId}}"}, { "fieldId": "Reply", "fieldValue": "={{$json.reply}}"}, { "fieldId": "Tag", "fieldValue": "={{$json.suggestedTag}}"} ] } }, "id":"6","name":"Airtable - Log","type":"n8n-nodes-base.airtable","typeVersion":2,"position":[1180,380], "credentials":{"airtableApi":{"id":"{{AIRTABLE_CRED_ID}}","name":"Airtable API"}}},
    { "parameters": { "responseBody":"={{$json}}","responseCode":200 }, "id":"7","name":"Return","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[1400,300]}
  ],
  "connections": {
    "Webhook (DM)": { "main": [ [ { "node": "Pass", "type": "main", "index": 0 } ] ] },
    "Pass": { "main": [ [ { "node": "OpenAI - DM Reply", "type": "main", "index": 0 } ] ] },
    "OpenAI - DM Reply": { "main": [ [ { "node": "Parse JSON", "type": "main", "index": 0 } ] ] },
    "Parse JSON": { "main": [ [ { "node": "HTTP - Send Reply to Platform", "type": "main", "index": 0 } ], [ { "node": "Airtable - Log", "type": "main", "index": 0 } ], [ { "node": "Return", "type": "main", "index": 0 } ] ] },
    "HTTP - Send Reply to Platform": { "main": [ [ { "node": "Return", "type": "main", "index": 0 } ] ] },
    "Airtable - Log": { "main": [ [ { "node": "Return", "type": "main", "index": 0 } ] ] }
  },
  "active": false
}
  </script>

  <!-- ===== CORE JS (revamped but same functionality) ===== -->
  <script>
  (function(){
    const $ = (id)=>document.getElementById(id);
    const slug=(s)=> (s||'').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'').slice(0,48)||'biz';
    const escapeHtml=(s)=> (s||'').replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" }[m]));

    /* ---- Demo chat ---- */
    function addMsg(role, text){
      const wrap=$('chatBox'); if(!wrap) return;
      const row=document.createElement('div');
      row.className='flex gap-3';
      if(role==='user'){ row.className+=' justify-end'; }
      row.innerHTML = role==='user'
        ? `<div class="max-w-[75%] bg-brand-500/20 rounded-xl px-3 py-2">${escapeHtml(text)}</div>`
        : `<div class="w-8 h-8 rounded-full bg-gradient-to-br from-brand-500 to-violetx-500 grid place-items-center text-black font-bold">A</div><div class="max-w-[75%] bg-white/5 rounded-xl px-3 py-2">${escapeHtml(text)}</div>`;
      wrap.appendChild(row); wrap.scrollTop=wrap.scrollHeight;
    }
    function wireChat(){
      const form=$('chatForm'), input=$('chatInput');
      if(!form||!input) return;
      form.addEventListener('submit',(e)=>{
        e.preventDefault();
        const t=input.value.trim(); if(!t) return;
        addMsg('user', t); input.value='';
        setTimeout(()=>addMsg('bot',"Thanks! (Demo only) — production runs inside your n8n workflows."), 400);
      });
      $('chatSend')?.addEventListener('click',()=>form.requestSubmit());
    }

    /* ---- Prompt builder ---- */
    const truncate=(s,n=1200)=> s && s.length>n ? s.slice(0,n)+' …' : (s||'');
    function getValues(){
      const v = Object.fromEntries(new FormData($('aiForm')).entries());
      try{ v.timezone ||= Intl.DateTimeFormat().resolvedOptions().timeZone; }catch{}
      v.agentName ||= 'Alex'; v.language ||= 'English';
      return v;
    }
    function buildLongPrompt(v={}){
      const tz=v.timezone||'America/New_York', biz=v.bizName||'the business', agent=v.agentName||'Alex';
      const industry=v.industry||'services', services=v.services||'General services', hours=v.hours||'Mon–Fri 9:00–17:00';
      const emailFrom=v.email||'no-reply@example.com';
      const now=(()=>{try{return new Date().toLocaleString('en-US',{timeZone:tz,weekday:'long',year:'numeric',month:'long',day:'2-digit',hour:'2-digit',minute:'2-digit'})}catch{return new Date().toLocaleString()}})();
      return `SYSTEM ROLE
You are ${agent}, a friendly, efficient AI receptionist for ${biz} (${industry}). Keep replies to 1–2 sentences, natural and clear.

CURRENT TIME
- ${now} (${tz})

BUSINESS CONTEXT
- Services: ${services}
- Hours: ${hours}

TASK
Answer questions and help book appointments quickly.

BOOKING FLOW
1) Ask for the preferred date/time (within business hours).
2) Check requested slot via calendar tool.
3) If unavailable, propose up to 3 nearby alternatives (same day or next business day).
4) Collect full name, email, phone.
5) Confirm slot and create the booking.
6) Summarize details and say a confirmation will be sent from ${emailFrom}.

STYLE & RULES
Natural, concise, confident. No emojis. Confirm final date/time + contact details.`;
    }

    function flashOk(msg){
      const ok=$('successMsg'); if(!ok) return;
      ok.textContent = msg; ok.classList.remove('hidden');
      clearTimeout(ok._t); ok._t=setTimeout(()=>ok.classList.add('hidden'),2000);
    }

    function downloadText(filename, data, mime='text/plain'){
      const a=document.createElement('a');
      a.href=URL.createObjectURL(new Blob([data], { type:mime })); a.download=filename; a.click();
      setTimeout(()=>URL.revokeObjectURL(a.href), 5000);
    }

    /* ---- Receptionist JSON templating ---- */
    function readTplObject(id){
      const node=$(id);
      if(!node){ const n=$('notice'); if(n) n.textContent=`Template "${id}" is missing.`; throw new Error('Missing template node: '+id); }
      const text=node.textContent??'';
      if(!text.trim()){ const n=$('notice'); if(n) n.textContent=`Template "${id}" is empty.`; throw new Error('Empty template: '+id); }
      return JSON.parse(text);
    }
    function setWorkflowTimezone(obj, tz){ obj.settings=obj.settings||{}; obj.settings.timezone = tz || obj.settings.timezone || 'America/New_York'; }
    function patchCalendarToolNode(obj, idOrPrimary){
      (obj.nodes||[]).forEach(n=>{
        if(n?.type==='n8n-nodes-base.googleCalendarTool' && n.parameters?.calendar && typeof n.parameters.calendar==='object'){
          n.parameters.calendar.value = idOrPrimary;
          n.parameters.calendar.cachedResultName = idOrPrimary;
        }
      });
    }
    function patchWebhookPath(obj, newPath){
      (obj.nodes||[]).forEach(n=>{
        if(n?.type==='n8n-nodes-base.webhook' && n.parameters){ n.parameters.path = newPath || n.parameters.path; }
      });
    }
    function renderWorkflow(tplId, v, kind){
      const obj=readTplObject(tplId);
      setWorkflowTimezone(obj, v.timezone);
      patchCalendarToolNode(obj, v.calendarId || 'primary');
      const base = 'aos-'+slug(v.bizName);
      patchWebhookPath(obj, kind==='book' ? `${base}-book` : `${base}-check`);
      return JSON.stringify(obj, null, 2);
    }

    async function doPreview(){
      const spinner=$('previewSpinner'), btn=$('previewBtn'), out=$('promptOut');
      btn.disabled=true; spinner?.classList.remove('hidden');
      try{
        const v=getValues();
        const longPrompt = buildLongPrompt(v);
        out.textContent = truncate(longPrompt);

        // Enable full prompt download
        const fullBtn=$('downloadPromptBtn');
        fullBtn.disabled=false;
        fullBtn.onclick=(e)=>{ e.preventDefault(); downloadText(`${slug(v.bizName)}_FULL_PROMPT.txt`, longPrompt, 'text/plain'); flashOk('Full prompt downloaded'); };

        // Prepare JSONs
        const avail = renderWorkflow('tplCheckAvailability', v, 'check');
        const book  = renderWorkflow('tplBookAppointment',  v, 'book');

        const dlA=$('downloadAvailBtn'), dlB=$('downloadBookBtn');
        dlA.disabled=false; dlB.disabled=false;
        dlA.onclick=(e)=>{ e.preventDefault(); downloadText('checkAvailability.json', avail, 'application/json'); flashOk('checkAvailability.json downloaded'); };
        dlB.onclick=(e)=>{ e.preventDefault(); downloadText('bookAppointment.json', book, 'application/json'); flashOk('bookAppointment.json downloaded'); };

        const n=$('notice'); if(n) n.textContent='Downloads ready. JSONs customized with your Calendar ID, Timezone, and unique webhook paths.';
      }catch(e){ console.error(e); alert('Error preparing downloads: '+e.message); }
      finally{ spinner?.classList.add('hidden'); btn.disabled=false; }
    }

    /* ---- Voice preview (11Labs) ---- */
    const audio=$('audio'), box=$('audioUI'), play=$('audioPlay'), seek=$('audioSeek'), tCur=$('audioTime'), tDur=$('audioDur');
    function fmt(t){ t=Math.max(0, t|0); const m=(t/60)|0, s=(t%60)|0; return m+':'+(s<10?'0':'')+s; }
    function sync(){
      if(!isFinite(audio.duration)) return;
      tDur.textContent=fmt(audio.duration); tCur.textContent=fmt(audio.currentTime);
      const pct=audio.currentTime/Math.max(1,audio.duration)*100; seek.value=pct; seek.style.setProperty('--pct', pct+'%');
      play.textContent = audio.paused ? '►' : '❚❚';
    }
    play?.addEventListener('click',()=> audio.paused?audio.play():audio.pause());
    audio?.addEventListener('play',sync); audio?.addEventListener('pause',sync); audio?.addEventListener('timeupdate',sync);
    audio?.addEventListener('loadedmetadata',()=>{ box.classList.remove('hidden'); sync(); });
    seek?.addEventListener('input', ()=>{ const pct=parseFloat(seek.value||'0')/100; if(isFinite(audio.duration)) audio.currentTime=audio.duration*pct; seek.style.setProperty('--pct', seek.value+'%'); });

    async function loadVoices(){
      const sel=$('voiceSelect'); if(!sel) return;
      try{
        const r=await fetch('/api/voices'); const j=await r.json();
        sel.innerHTML=''; (j?.data?.voices||[]).forEach(v=>{ const o=document.createElement('option'); o.value=v.id; o.textContent=v.name; sel.appendChild(o); });
        if(!sel.children.length) throw 0;
      }catch{
        sel.innerHTML='';
        [{id:'UgBBYS2sOqTuMpoF3BR0',name:'AOS Male Clean'},
         {id:'21m00Tcm4TlvDq8ikWAM',name:'Eleven — Adam'},
         {id:'AZnzlk1XvdvUeBnXmlld',name:'Eleven — Bella'}]
        .forEach(v=>{ const o=document.createElement('option'); o.value=v.id; o.textContent=v.name; sel.appendChild(o); });
      }
    }

    async function doTTS(){
      const ttsBtn = $('ttsBtn'); if (ttsBtn) ttsBtn.disabled = true;
      const v=getValues();
      const voice_id = ($('voiceSelect')?.value)||'';
      const text=`Hi, this is ${v.agentName||'Alex'} with ${v.bizName||'your business'}. How can I help you today?`;

      async function call(body){
        const res = await fetch('/api/tts', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) });
        let data=null; try{ data=await res.json(); }catch{}
        if(!res.ok || !data?.ok){
          const msg = data?.message || `HTTP ${res.status}`;
          const code= data?.code || 'UNKNOWN';
          throw new Error(`[${code}] ${msg}`);
        }
        return data.data.audioBase64;
      }
      try{
        let audioB64;
        try{ audioB64 = await call({ text, voice_id }); }
        catch(e){ if(String(e).includes('concurrent')){ audioB64 = await call({ text }); } else { throw e; } }
        audio.src = audioB64; audio.load(); $('audioDownload').href = audioB64; await audio.play().catch(()=>{});
      }catch(e){ console.error(e); alert('TTS failed: '+ e.message); }
      finally{ setTimeout(()=>{ if(ttsBtn) ttsBtn.disabled=false; }, 1100); }
    }

    document.addEventListener('click',(ev)=>{
      if(ev.target.closest('#previewBtn')){ ev.preventDefault(); doPreview(); }
      if(ev.target.closest('#ttsBtn')){ ev.preventDefault(); doTTS(); }
    });

    /* ---- SPA (Agents) ---- */
    const VIEW_AGENT = document.getElementById('view-agent');

    const AGENTS = {
      invoice: {
        title: 'AI Invoice / Follow-ups',
        desc: 'Generate invoices + polite reminders and email them. Logs to Airtable.',
        promptId: 'prInvoice',
        tplId: 'tplAgentInvoice',
        fields: [
          {name:'bizName', label:'Business Name', req:true},
          {name:'agentName', label:'Agent Name', value:'Ava'},
          {name:'email', label:'Business Email (from)', req:true},
          {name:'timezone', label:'Timezone', value:'America/New_York'},
          {name:'openaiModel', label:'OpenAI Model', value:'gpt-4o-mini'},
          {name:'paymentLink', label:'Payment Link (Stripe/PayPal)', req:true},
          {name:'taxRules', label:'Tax Rules (optional)'},
          {name:'airtableBaseId', label:'Airtable Base ID'},
          {name:'airtableTable', label:'Airtable Table', value:'Invoices'},
          {name:'airtableCredId', label:'Airtable Credential ID'},
          {name:'smtpFrom', label:'SMTP From (no-reply@...)'},
          {name:'smtpCredId', label:'SMTP Credential ID'}
        ],
        map: (v)=>({
          BIZ_NAME:v.bizName, AGENT_NAME:v.agentName, BIZ_EMAIL:v.email, TIMEZONE:v.timezone,
          OPENAI_MODEL:v.openaiModel, PAYMENT_LINK:v.paymentLink, TAX_RULES_SNIPPET:v.taxRules||'',
          AIRTABLE_BASE_ID:v.airtableBaseId||'', AIRTABLE_TABLE:v.airtableTable||'Logs', AIRTABLE_CRED_ID:v.airtableCredId||'',
          SMTP_FROM:v.smtpFrom||'no-reply@example.com', SMTP_CRED_ID:v.smtpCredId||'SMTP_CREDENTIAL',
          OPENAI_API_KEY:'USE_N8N_CREDENTIALS'
        }),
        fileBase: 'invoice'
      },
      salesCloser: {
        title: 'AI Sales Closer',
        desc: 'Objection-aware nudges via SMS/Email. Auto-logs follow-ups.',
        promptId: 'prSalesCloser',
        tplId: 'tplAgentSalesCloser',
        fields: [
          {name:'bizName', label:'Business Name', req:true},
          {name:'agentName', label:'Agent Name', value:'Ava'},
          {name:'email', label:'Business Email (from)', req:true},
          {name:'openaiModel', label:'OpenAI Model', value:'gpt-4o-mini'},
          {name:'offerSnippet', label:'Offer Snippet', req:true},
          {name:'ctaUrl', label:'CTA URL (checkout/booking)', req:true},
          {name:'followupGap', label:'Follow-up Gap (hours)', value:'24'},
          {name:'airtableBaseId', label:'Airtable Base ID'},
          {name:'airtableTable', label:'Airtable Table', value:'Sales'},
          {name:'airtableCredId', label:'Airtable Credential ID'},
          {name:'smtpFrom', label:'SMTP From (no-reply@...)'},
          {name:'smtpCredId', label:'SMTP Credential ID'},
          {name:'twilioFrom', label:'Twilio From +1...'},
          {name:'twilioCredId', label:'Twilio Credential ID'}
        ],
        map: (v)=>({
          BIZ_NAME:v.bizName, AGENT_NAME:v.agentName, BIZ_EMAIL:v.email,
          OPENAI_MODEL:v.openaiModel, OFFER_SNIPPET:v.offerSnippet, CTA_URL:v.ctaUrl,
          FOLLOWUP_GAP_HOURS:v.followupGap||'24',
          AIRTABLE_BASE_ID:v.airtableBaseId||'', AIRTABLE_TABLE:v.airtableTable||'Logs', AIRTABLE_CRED_ID:v.airtableCredId||'',
          SMTP_FROM:v.smtpFrom||'no-reply@example.com', SMTP_CRED_ID:v.smtpCredId||'SMTP_CREDENTIAL',
          TWILIO_FROM:v.twilioFrom||'', TWILIO_CRED_ID:v.twilioCredId||'',
          OPENAI_API_KEY:'USE_N8N_CREDENTIALS'
        }),
        fileBase:'salesCloser'
      },
      leadQualifier: {
        title: 'AI Lead Qualifier',
        desc: 'Score & route leads (A/B/C). Email both lead & owner.',
        promptId: 'prLeadQualifier',
        tplId: 'tplAgentLeadQualifier',
        fields: [
          {name:'bizName', label:'Business Name', req:true},
          {name:'agentName', label:'Agent Name', value:'Ava'},
          {name:'email', label:'Owner/Team Email', req:true},
          {name:'openaiModel', label:'OpenAI Model', value:'gpt-4o-mini'},
          {name:'qualRules', label:'Qualifier Rules (A/B/C tiers)', value:'A: ready budget & timeline; B: missing one; C: mismatch'},
          {name:'airtableBaseId', label:'Airtable Base ID'},
          {name:'airtableTable', label:'Airtable Table', value:'Leads'},
          {name:'airtableCredId', label:'Airtable Credential ID'},
          {name:'smtpFrom', label:'SMTP From (no-reply@...)'},
          {name:'smtpCredId', label:'SMTP Credential ID'}
        ],
        map:(v)=>({
          BIZ_NAME:v.bizName, AGENT_NAME:v.agentName, BIZ_EMAIL:v.email,
          OPENAI_MODEL:v.openaiModel, QUAL_RULES:v.qualRules,
          AIRTABLE_BASE_ID:v.airtableBaseId||'', AIRTABLE_TABLE:v.airtableTable||'Logs', AIRTABLE_CRED_ID:v.airtableCredId||'',
          SMTP_FROM:v.smtpFrom||'no-reply@example.com', SMTP_CRED_ID:v.smtpCredId||'SMTP_CREDENTIAL',
          OPENAI_API_KEY:'USE_N8N_CREDENTIALS'
        }),
        fileBase:'leadQualifier'
      },
      dmResponder: {
        title: 'AI DM Responder',
        desc: 'Short replies for IG/TikTok that push to your CTA. Tags & logs.',
        promptId: 'prDMResponder',
        tplId: 'tplAgentDMResponder',
        fields: [
          {name:'bizName', label:'Business Name', req:true},
          {name:'agentName', label:'Agent Name', value:'Ava'},
          {name:'email', label:'Owner/Team Email (for logs)', req:true},
          {name:'openaiModel', label:'OpenAI Model', value:'gpt-4o-mini'},
          {name:'platformWebhook', label:'Platform Reply Webhook (Make/Zapier)', req:true},
          {name:'bookUrl', label:'Booking URL', req:true},
          {name:'faqUrl', label:'FAQ URL'},
          {name:'airtableBaseId', label:'Airtable Base ID'},
          {name:'airtableTable', label:'Airtable Table', value:'DMs'},
          {name:'airtableCredId', label:'Airtable Credential ID'}
        ],
        map:(v)=>({
          BIZ_NAME:v.bizName, AGENT_NAME:v.agentName, BIZ_EMAIL:v.email,
          OPENAI_MODEL:v.openaiModel, PLATFORM_REPLY_WEBHOOK:v.platformWebhook,
          BOOK_URL:v.bookUrl, FAQ_URL:v.faqUrl||'', PRIMARY_CTA:'book',
          AIRTABLE_BASE_ID:v.airtableBaseId||'', AIRTABLE_TABLE:v.airtableTable||'Logs', AIRTABLE_CRED_ID:v.airtableCredId||'',
          OPENAI_API_KEY:'USE_N8N_CREDENTIALS'
        }),
        fileBase:'dmResponder'
      }
    };

    function getScriptText(id){ const el=document.getElementById(id); if(!el) throw new Error('Missing node: '+id); return el.textContent||''; }
    function injectPlaceholders(str, map){ return Object.entries(map).reduce((acc,[k,v])=> acc.replaceAll(`{{${k}}}`, String(v ?? '')), String(str)); }

    function renderAgentForm(def){
      const f=$('agentForm'); f.innerHTML='';
      def.fields.forEach(field=>{
        const wrap=document.createElement('div');
        wrap.innerHTML = `<label class="block text-sm text-white/70 mb-1">${field.label}${field.req? ' <span class="text-red-400">*</span>':''}</label><input name="${field.name}" value="${field.value||''}" placeholder="${field.label}" class="w-full">`;
        f.appendChild(wrap);
      });
    }
    function readAgentVals(){ return Object.fromEntries(new FormData($('agentForm')).entries()); }

    function buildAgent(def){
      const v=readAgentVals();
      const missing = def.fields.filter(x=>x.req && !v[x.name]?.trim()).map(x=>x.label);
      if(missing.length) throw new Error('Missing: '+missing.join(', '));
      const map = def.map(v);

      let prompt=getScriptText(def.promptId);
      prompt = injectPlaceholders(prompt, map);

      let tpl=getScriptText(def.tplId);
      const longForJSON = prompt.replace(/`/g,'\\`').replace(/\n/g,'\\n');
      tpl = tpl.replace(/YOU_ARE_[A-Z_]+/g, longForJSON);
      tpl = injectPlaceholders(tpl, map);

      return { prompt, json: JSON.stringify(JSON.parse(tpl), null, 2) };
    }

    function route(){
      const hash=location.hash || '#/';
      const m=hash.match(/^#\/agent\/([a-zA-Z0-9_-]+)$/);
      if(m){
        const key=m[1]; const def=AGENTS[key];
        if(!def){ location.hash='#/'; return; }
        document.getElementById('view-agent').classList.remove('hidden');
        document.getElementById('view-home')?.classList.add('hidden');
        $('agentTitle').textContent=def.title; $('agentDesc').textContent=def.desc; renderAgentForm(def);
        $('agentPromptPreview').textContent='';
        $('agentGenerate').onclick=(e)=>{
          e.preventDefault();
          try{
            const out=buildAgent(def);
            $('agentPromptPreview').textContent=out.prompt;
            $('agentPromptDownload').href=URL.createObjectURL(new Blob([out.prompt],{type:'text/plain'}));
            $('agentPromptDownload').download=`${def.fileBase}-FULL-PROMPT.txt`;
            $('agentJsonDownload').href=URL.createObjectURL(new Blob([out.json],{type:'application/json'}));
            $('agentJsonDownload').download=`${def.fileBase}-workflow.json`;
            const ok=$('agentMsg'); ok.classList.remove('hidden'); setTimeout(()=>ok.classList.add('hidden'),1500);
          }catch(err){ alert(err.message); }
        };
        $('agentPromptDownload').onclick=(e)=>{ if(!$('agentPromptPreview').textContent) e.preventDefault(); };
        $('agentJsonDownload').onclick=(e)=>{ if(!$('agentPromptPreview').textContent) e.preventDefault(); };
      }else{
        document.getElementById('view-agent').classList.add('hidden');
        document.getElementById('view-home')?.classList.remove('hidden');
      }
    }

    function init(){ wireChat(); loadVoices(); route(); }
    if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', init); else init();
    window.addEventListener('hashchange', route);
  })();
  </script>
</body>
</html>
